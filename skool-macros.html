
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Skool macros &#8212; SkoolKit 9.3 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Ref files" href="ref-files.html" />
    <link rel="prev" title="Skool files" href="skool-files.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ref-files.html" title="Ref files"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="skool-files.html" title="Skool files"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SkoolKit 9.3 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Skool macros</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="skool-macros">
<span id="skoolmacros"></span><h1>Skool macros<a class="headerlink" href="#skool-macros" title="Permalink to this heading">¶</a></h1>
<p>Skool files and ref files may contain skool macros that are ‘expanded’ to an
appropriate piece of HTML markup (when rendering in HTML mode), or to an
appropriate piece of plain text (when rendering in ASM mode).</p>
<section id="syntax">
<h2>Syntax<a class="headerlink" href="#syntax" title="Permalink to this heading">¶</a></h2>
<p>Skool macros have the following general form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#MACROri1,ri2,...[,oi1,oi2,...](rs1,rs2,...[,os1,os2,...])
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">MACRO</span></code> is the macro name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ri1</span></code>, <code class="docutils literal notranslate"><span class="pre">ri2</span></code> etc. are required integer parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">oi1</span></code>, <code class="docutils literal notranslate"><span class="pre">oi2</span></code> etc. are optional integer parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rs1</span></code>, <code class="docutils literal notranslate"><span class="pre">rs2</span></code> etc. are required string parameters</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">os1</span></code>, <code class="docutils literal notranslate"><span class="pre">os2</span></code> etc. are optional string parameters</p></li>
</ul>
<p>If an optional parameter is left blank or omitted entirely, it assumes its
default value. So, for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG39144
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG39144,56,4,1,0,0,0,1
</pre></div>
</div>
<p>and:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG30115,,2
</pre></div>
</div>
<p>is equivalent to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG30115,56,2
</pre></div>
</div>
</section>
<section id="numeric-parameters">
<span id="numericparameters"></span><h2>Numeric parameters<a class="headerlink" href="#numeric-parameters" title="Permalink to this heading">¶</a></h2>
<p>Numeric parameters may be written in decimal notation:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG51673,17
</pre></div>
</div>
<p>or in hexadecimal notation (prefixed by <code class="docutils literal notranslate"><span class="pre">$</span></code>):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG$C9D9,$11
</pre></div>
</div>
<p>Wherever a sequence of numeric parameters appears in a macro, that sequence
may optionally be enclosed in parentheses: <code class="docutils literal notranslate"><span class="pre">(</span></code> and <code class="docutils literal notranslate"><span class="pre">)</span></code>. Parentheses are
generally recommended - especially when there are two or more parameters - in
order to unambiguously separate the numeric parameters from any content that
follows them. Parentheses are <cite>required</cite> if any numeric parameter is written as
an expression containing arithmetic operations, skool macros or replacement
fields:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG(51672+{offset},#PEEK51672)
</pre></div>
</div>
<p>The following operators are permitted in an arithmetic expression:</p>
<ul class="simple">
<li><p>arithmetic operators: <code class="docutils literal notranslate"><span class="pre">+</span></code>, <code class="docutils literal notranslate"><span class="pre">-</span></code>, <code class="docutils literal notranslate"><span class="pre">*</span></code>, <code class="docutils literal notranslate"><span class="pre">/</span></code>, <code class="docutils literal notranslate"><span class="pre">%</span></code> (modulo), <code class="docutils literal notranslate"><span class="pre">**</span></code>
(power)</p></li>
<li><p>bitwise operators: <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> (AND), <code class="docutils literal notranslate"><span class="pre">|</span></code> (OR), <code class="docutils literal notranslate"><span class="pre">^</span></code> (XOR)</p></li>
<li><p>bit shift operators: <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code></p></li>
<li><p>Boolean operators: <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> (and), <code class="docutils literal notranslate"><span class="pre">||</span></code> (or)</p></li>
<li><p>comparison operators: <code class="docutils literal notranslate"><span class="pre">==</span></code>, <code class="docutils literal notranslate"><span class="pre">!=</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;</span></code>, <code class="docutils literal notranslate"><span class="pre">&gt;=</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;=</span></code></p></li>
</ul>
<p>Parentheses and spaces are also permitted in an arithmetic expression:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#IF(1 == 2 || (1 &lt;= 2 &amp;&amp; 2 &lt; 3))(Yes,No)
</pre></div>
</div>
</section>
<section id="string-parameters">
<span id="stringparameters"></span><h2>String parameters<a class="headerlink" href="#string-parameters" title="Permalink to this heading">¶</a></h2>
<p>Where a macro requires a single string parameter consisting of arbitrary text,
it must be enclosed in parentheses, square brackets or braces:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(text)
[text]
{text}
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">text</span></code> contains unbalanced brackets, a non-whitespace character that is
not present in <code class="docutils literal notranslate"><span class="pre">text</span></code> may be used as an alternative delimiter. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/text/
|text|
</pre></div>
</div>
<p>Where a macro requires multiple string parameters consisting of arbitrary text,
they must be enclosed in parentheses, square brackets or braces and be
separated by commas:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>(string1,string2)
[string1,string2]
{string1,string2}
</pre></div>
</div>
<p>When a comma-separated sequence of string parameters is split, any commas that
appear between parentheses are retained. For example, the string parameters
of the outer <code class="docutils literal notranslate"><span class="pre">#FOR</span></code> macro in:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#FOR0,1(n,#FOR(0,1)(m,(n,m),;),;)
</pre></div>
</div>
<p>are split into <code class="docutils literal notranslate"><span class="pre">n</span></code>, <code class="docutils literal notranslate"><span class="pre">#FOR(0,1)(m,(n,m),;)</span></code> and <code class="docutils literal notranslate"><span class="pre">;</span></code>, and the string
parameters of the inner <code class="docutils literal notranslate"><span class="pre">#FOR</span></code> macro are split into <code class="docutils literal notranslate"><span class="pre">m</span></code>, <code class="docutils literal notranslate"><span class="pre">(n,m)</span></code>, and
<code class="docutils literal notranslate"><span class="pre">;</span></code>.</p>
<p>Alternatively, an arbitrary delimiter - <code class="docutils literal notranslate"><span class="pre">d</span></code>, which cannot be whitespace - and
separator - <code class="docutils literal notranslate"><span class="pre">s</span></code>, which can be whitespace - may be used. (They can be the same
character.) The string parameters must open with <code class="docutils literal notranslate"><span class="pre">ds</span></code>, be separated by <code class="docutils literal notranslate"><span class="pre">s</span></code>,
and close with <code class="docutils literal notranslate"><span class="pre">sd</span></code>. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>//same/delimiter/and/separator//
| different delimiter and separator |
</pre></div>
</div>
<p>Note that if an alternative delimiter or separator is used, it must not be ‘&amp;’,
‘&lt;’ or ‘&gt;’.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 6.4: </span>When a comma-separated sequence of string parameters is split, any commas
that appear between parentheses are retained.</p>
</div>
</section>
<section id="replacement-fields">
<span id="replacementfields"></span><h2>Replacement fields<a class="headerlink" href="#replacement-fields" title="Permalink to this heading">¶</a></h2>
<p>The following replacement fields are available for use in the integer
parameters of the <a class="reference internal" href="asm.html#asm-if"><span class="std std-ref">&#64;if</span></a> directive and every skool macro (including
macros defined by <a class="reference internal" href="#def"><span class="std std-ref">#DEF</span></a>), and also in the string parameters of some
macros:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">asm</span></code> - 1 if in <a class="reference internal" href="asm.html#isubmode"><span class="std std-ref">&#64;isub mode</span></a>, 2 if in <a class="reference internal" href="asm.html#ssubmode"><span class="std std-ref">&#64;ssub mode</span></a>, 3 if in
<a class="reference internal" href="asm.html#rsubmode"><span class="std std-ref">&#64;rsub mode</span></a>, or 0 otherwise</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">base</span></code> - 10 if the <code class="docutils literal notranslate"><span class="pre">--decimal</span></code> option is used with <a class="reference internal" href="commands.html#skool2asm-py"><span class="std std-ref">skool2asm.py</span></a>
or <a class="reference internal" href="commands.html#skool2html-py"><span class="std std-ref">skool2html.py</span></a>, 16 if the <code class="docutils literal notranslate"><span class="pre">--hex</span></code> option is used, or 0 if neither
option is used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">case</span></code> - 1 if the <code class="docutils literal notranslate"><span class="pre">--lower</span></code> option is used with <a class="reference internal" href="commands.html#skool2asm-py"><span class="std std-ref">skool2asm.py</span></a>
or <a class="reference internal" href="commands.html#skool2html-py"><span class="std std-ref">skool2html.py</span></a>, 2 if the <code class="docutils literal notranslate"><span class="pre">--upper</span></code> option is used, or 0 if neither
option is used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fix</span></code> - 1 if in <a class="reference internal" href="asm.html#ofixmode"><span class="std std-ref">&#64;ofix mode</span></a>, 2 if in <a class="reference internal" href="asm.html#bfixmode"><span class="std std-ref">&#64;bfix mode</span></a>, 3 if in
<a class="reference internal" href="asm.html#rfixmode"><span class="std std-ref">&#64;rfix mode</span></a>, or 0 otherwise</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">html</span></code> - 1 if in HTML mode, 0 otherwise</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code> - a dictionary containing a copy of the <code class="docutils literal notranslate"><span class="pre">asm</span></code>, <code class="docutils literal notranslate"><span class="pre">base</span></code>, <code class="docutils literal notranslate"><span class="pre">case</span></code>,
<code class="docutils literal notranslate"><span class="pre">fix</span></code> and <code class="docutils literal notranslate"><span class="pre">html</span></code> fields</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim</span></code> - a dictionary of register values populated by the <a class="reference internal" href="#sim"><span class="std std-ref">#SIM</span></a> macro</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vars</span></code> - a dictionary of variables defined by the <code class="docutils literal notranslate"><span class="pre">--var</span></code> option of
<a class="reference internal" href="commands.html#skool2asm-py"><span class="std std-ref">skool2asm.py</span></a> or <a class="reference internal" href="commands.html#skool2html-py"><span class="std std-ref">skool2html.py</span></a>; accessing an undefined variable
in this dictionary yields the integer value ‘0’</p></li>
</ul>
<p>Replacement fields for the variables defined by the <a class="reference internal" href="#let"><span class="std std-ref">#LET</span></a> macro are also
available. Note that the <code class="docutils literal notranslate"><span class="pre">#LET</span></code> macro can change the values of the <code class="docutils literal notranslate"><span class="pre">asm</span></code>,
<code class="docutils literal notranslate"><span class="pre">base</span></code>, <code class="docutils literal notranslate"><span class="pre">case</span></code>, <code class="docutils literal notranslate"><span class="pre">fix</span></code> and <code class="docutils literal notranslate"><span class="pre">html</span></code> fields, but their original values are
always available in the <code class="docutils literal notranslate"><span class="pre">mode</span></code> dictionary.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#IF({mode[case]}==1)(hl,HL)
</pre></div>
</div>
<p>expands to <code class="docutils literal notranslate"><span class="pre">hl</span></code> if in lower case mode, or <code class="docutils literal notranslate"><span class="pre">HL</span></code> otherwise.</p>
<p>Note that if a replacement field is used, the parameter string must be
enclosed in parentheses.</p>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 8.7: </span>Added the <code class="docutils literal notranslate"><span class="pre">sim</span></code> dictionary.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 8.2: </span>Added the <code class="docutils literal notranslate"><span class="pre">mode</span></code> dictionary.</p>
</div>
<div class="versionchanged">
<p><span class="versionmodified changed">Changed in version 6.4: </span>The <code class="docutils literal notranslate"><span class="pre">asm</span></code> replacement field indicates the exact ASM mode; added the
<code class="docutils literal notranslate"><span class="pre">fix</span></code> and <code class="docutils literal notranslate"><span class="pre">vars</span></code> replacement fields.</p>
</div>
</section>
<section id="smpl-macros">
<span id="smplmacros"></span><h2>SMPL macros<a class="headerlink" href="#smpl-macros" title="Permalink to this heading">¶</a></h2>
<p>The macros described in this section constitute the Skool Macro Programming
Language (SMPL). They can be used to programmatically specify values in the
parameter string of any macro.</p>
<section id="hash">
<span id="id1"></span><h3>#()<a class="headerlink" href="#hash" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#()</span></code> macro expands the skool macros in its sole string parameter.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#(text)
</pre></div>
</div>
<p>It takes effect only when it immediately follows the opening token of another
skool macro, and is expanded <cite>before</cite> that macro. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDGARRAY#(2(#FOR37159,37168,9||n|(n+1),#PEEKn|;||))(item)
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#()</span></code> macro expands the <code class="docutils literal notranslate"><span class="pre">#FOR</span></code> macro first, giving:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>2((37159+1),#PEEK37159;(37168+1),#PEEK37168)
</pre></div>
</div>
<p>It then expands the <code class="docutils literal notranslate"><span class="pre">#PEEK</span></code> macros, ultimately forming the parameters of the
<code class="docutils literal notranslate"><span class="pre">#UDGARRAY</span></code> macro.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">text</span></code> parameter. Note that if an alternative delimiter is used, it must not
be an alphanumeric character (A-Z, a-z, 0-9).</p>
</section>
<section id="def">
<span id="id2"></span><h3>#DEF<a class="headerlink" href="#def" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#DEF</span></code> macro defines a new skool macro.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF[flags](#MACRO[(ia[=i0],ib[=i1]...)[(sa[=s0],sb[=s1]...)]] body)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flags</span></code> controls various options (see below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MACRO</span></code> is the macro name (which must be all upper case letters)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ia[=i0]</span></code>, <code class="docutils literal notranslate"><span class="pre">ib[=i1]</span></code> etc. are the integer parameter names and optional
default values; the parameter names must consist of lower case letters only</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sa[=s0]</span></code>, <code class="docutils literal notranslate"><span class="pre">sb[=s1]</span></code> etc. are the string parameter names and optional
default values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">body</span></code> is the body of the macro definition, which may contain placeholders
(<code class="docutils literal notranslate"><span class="pre">$var</span></code>, <code class="docutils literal notranslate"><span class="pre">${var}</span></code> - when <code class="docutils literal notranslate"><span class="pre">flags</span></code> is 0) or replacement fields
(<code class="docutils literal notranslate"><span class="pre">{var}</span></code> - when <code class="docutils literal notranslate"><span class="pre">flags</span></code> is 1) representing the integer and string
argument values</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">flags</span></code> is the sum of the following values, chosen according to the desired
outcome:</p>
<ul class="simple">
<li><p>1 - use replacement fields (e.g. <code class="docutils literal notranslate"><span class="pre">{var}</span></code>) instead of $-placeholders
(<code class="docutils literal notranslate"><span class="pre">$var</span></code>, <code class="docutils literal notranslate"><span class="pre">${var}</span></code>) to represent the defined macro’s argument values</p></li>
<li><p>2 - strip leading and trailing whitespace from the output of the defined
macro whenever it is expanded</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF(#MIN(a,b) #IF($a&lt;$b)($a,$b))
</pre></div>
</div>
<p>This defines a <code class="docutils literal notranslate"><span class="pre">#MIN</span></code> macro that accepts two integer arguments and expands to
the value of the smaller argument.</p>
<p>Default values for the defined macro’s optional integer parameters can be
specified in the macro’s signature. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF(#PROD(a,b=1,c=1) #EVAL($a*$b*$c))
</pre></div>
</div>
<p>This defines a <code class="docutils literal notranslate"><span class="pre">#PROD</span></code> macro that accepts one, two or three integer
arguments, the second and third of which default to 1, and expands to the
product of all three arguments.</p>
<p>Default values for the defined macro’s optional string parameters can also be
specified in the macro’s signature, and their default values may refer to the
integer argument values. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF(#NUM(a)(s=$a) $s)
</pre></div>
</div>
<p>This defines a <code class="docutils literal notranslate"><span class="pre">#NUM</span></code> macro that accepts one integer argument and an optional
string argument. It expands either to the integer argument, or to the string
argument if provided. So <code class="docutils literal notranslate"><span class="pre">#NUM15</span></code> expands to ‘15’, and <code class="docutils literal notranslate"><span class="pre">#NUM15($0F)</span></code>
expands to ‘$0F’.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">flags</span></code> is odd (bit 0 set), replacement fields are used instead of
$-placeholders to represent the defined macro’s argument values. The main
advantage of using replacement fields is that Python string formatting options
can be used on the argument values. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF1(#HEX(n) {n:04X})
</pre></div>
</div>
<p>This defines a <code class="docutils literal notranslate"><span class="pre">#HEX</span></code> macro that formats its sole integer argument as a
4-digit upper case hexadecimal number.</p>
<p>However, when using replacement fields, care must be taken to escape any field
that doesn’t represent an argument value. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#LET(count=0)
#DEF1(#ADD(amount) #LET(count={{count}}+{amount}))
</pre></div>
</div>
<p>This defines a variable named <code class="docutils literal notranslate"><span class="pre">count</span></code>, and an <code class="docutils literal notranslate"><span class="pre">#ADD</span></code> macro that increases
its value by a given amount. Note how the replacement field for the <code class="docutils literal notranslate"><span class="pre">count</span></code>
variable in the body of the macro definition is escaped: <code class="docutils literal notranslate"><span class="pre">{{count}}</span></code>.</p>
<p>If bit 1 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> is set, the defined macro will be expanded, in isolation
from any surrounding content, as soon as it is encountered. For that to work,
the macro definition must be entirely self-contained, i.e. it must not depend
on any surrounding content in order to be syntactically correct. For example,
if the <code class="docutils literal notranslate"><span class="pre">#IFZERO</span></code> macro is defined thus:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF2(#IFZERO(n) #IF($n==0))
</pre></div>
</div>
<p>then any attempt to expand an <code class="docutils literal notranslate"><span class="pre">#IFZERO</span></code> macro will lead to an error message
about the <code class="docutils literal notranslate"><span class="pre">#IF</span></code> macro having no output strings. To fix this, either reset
bit 1 of <code class="docutils literal notranslate"><span class="pre">flags</span></code>, or redefine <code class="docutils literal notranslate"><span class="pre">#IFZERO</span></code> with the output strings included in
the definition:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF2(#IFZERO(n)(a,b) #IF($n==0)($a,$b))
</pre></div>
</div>
<p>For more examples, see <a class="reference internal" href="#definingmacroswithdef"><span class="std std-ref">Defining macros with #DEF</span></a>.</p>
<p>Note that if a string parameter of a defined macro is optional, that argument
will take its default value only if it is omitted; if instead it is left blank,
it takes the value of the empty string.</p>
<p>In general, the string arguments of a defined macro may be supplied between
alternative delimiters (see <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a>) if desired. However, if
every string parameter of the defined macro is optional, the string arguments
must be either omitted entirely or provided between parentheses (and therefore
separated by commas). This allows a macro with all of its optional string
arguments omitted to be immediately followed by some character other than an
opening parenthesis without that character being interpreted as an alternative
delimiter.</p>
<p>To define a macro that will be available for use immediately anywhere in the
skool file or ref files, consider using the <a class="reference internal" href="asm.html#expand"><span class="std std-ref">&#64;expand</span></a> directive, or the
<code class="docutils literal notranslate"><span class="pre">Expand</span></code> parameter in the <a class="reference internal" href="ref-files.html#ref-config"><span class="std std-ref">[Config]</span></a> section.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">flags</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">#DEF</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>The integer parameters of a macro defined by <code class="docutils literal notranslate"><span class="pre">#DEF</span></code> may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>, and may also be supplied via
keyword arguments.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.6</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">flags</span></code> parameter, the ability to use replacement
fields to represent the defined macro’s argument values, and the
ability to strip whitespace from the defined macro’s output</p></td>
</tr>
<tr class="row-odd"><td><p>8.5</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="eval">
<span id="id3"></span><h3>#EVAL<a class="headerlink" href="#eval" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#EVAL</span></code> macro expands to the value of an arithmetic expression.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#EVALexpr[,base,width]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">expr</span></code> is the arithmetic expression</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">base</span></code> is the number base in which the value is expressed: 2, 10 (the
default) or 16</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">width</span></code> is the minimum number of digits in the output (default: 1); the
value will be padded with leading zeroes if necessary</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; The following mask byte is #EVAL(#PEEK29435,2,8).
 29435 DEFB 62
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#EVAL</span></code> macro expands to ‘00111110’ (62 in binary).</p>
<p>The parameter string of the <code class="docutils literal notranslate"><span class="pre">#EVAL</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.0</p></td>
<td><p>Added support for replacement fields in the parameter string</p></td>
</tr>
<tr class="row-odd"><td><p>6.0</p></td>
<td><p>Hexadecimal values are rendered in lower case when the
<code class="docutils literal notranslate"><span class="pre">--lower</span></code> option is used</p></td>
</tr>
<tr class="row-even"><td><p>5.1</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="for">
<span id="id4"></span><h3>#FOR<a class="headerlink" href="#for" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#FOR</span></code> macro expands to a sequence of strings based on a range of
integers.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#FORstart,stop[,step,flags](var,string[,sep,fsep])
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> is first integer in the range</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code> is the final integer in the range</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is the gap between each integer in the range (default: 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flags</span></code> controls whether to affix commas to or replace variable names in
each separator (see below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">var</span></code> is the variable name; for each integer in the range, it evaluates to
that integer</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">string</span></code> is the output string that is evaluated for each integer in the
range; wherever the variable name (<code class="docutils literal notranslate"><span class="pre">var</span></code>) appears, its value is substituted</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep</span></code> is the separator placed between each output string (default: the
empty string); this may be modified depending on the value of <code class="docutils literal notranslate"><span class="pre">flags</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fsep</span></code> is the separator placed between the final two output strings
(default: <code class="docutils literal notranslate"><span class="pre">sep</span></code>)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">flags</span></code> is the sum of the following values, chosen according to the desired
outcome:</p>
<ul class="simple">
<li><p>1 - prefix each separator (<code class="docutils literal notranslate"><span class="pre">sep</span></code>) with a comma</p></li>
<li><p>2 - suffix each separator (<code class="docutils literal notranslate"><span class="pre">sep</span></code>) with a comma</p></li>
<li><p>4 - replace any variable name (<code class="docutils literal notranslate"><span class="pre">var</span></code>) in each separator (<code class="docutils literal notranslate"><span class="pre">sep</span></code>) with the
variable value</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; The next three bytes (#FOR31734,31736,,1(n,#PEEKn, , and )) define the
; item locations.
 31734 DEFB 24,17,156
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#FOR</span></code> macro expands to ‘24, 17 and 156’.</p>
<p>The integer parameters of the <code class="docutils literal notranslate"><span class="pre">#FOR</span></code> macro (<code class="docutils literal notranslate"><span class="pre">start</span></code>, <code class="docutils literal notranslate"><span class="pre">stop</span></code>, <code class="docutils literal notranslate"><span class="pre">step</span></code>,
<code class="docutils literal notranslate"><span class="pre">flags</span></code>) may contain <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">var</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">sep</span></code> and <code class="docutils literal notranslate"><span class="pre">fsep</span></code> parameters.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.7</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">flags</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>8.2</p></td>
<td><p>Added support for replacement fields in the integer parameters</p></td>
</tr>
<tr class="row-even"><td><p>5.1</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="foreach">
<span id="id5"></span><h3>#FOREACH<a class="headerlink" href="#foreach" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#FOREACH</span></code> macro expands to a sequence of output strings based on a
sequence of input strings.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#FOREACH([s1,s2,...])(var,string[,sep,fsep])
</pre></div>
</div>
<p>or:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#FOREACH(svar)(var,string[,sep,fsep])
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">s1</span></code>, <code class="docutils literal notranslate"><span class="pre">s2</span></code>  etc. are the input strings</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">svar</span></code> is a special variable that expands to a specific sequence of input
strings (see below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">var</span></code> is the variable name; for each input string, it evaluates to that
string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">string</span></code> is the output string that is evaluated for each input string;
wherever the variable name (<code class="docutils literal notranslate"><span class="pre">var</span></code>) appears, its value is substituted</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sep</span></code> is the separator placed between each output string (default: the
empty string)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fsep</span></code> is the separator placed between the final two output strings
(default: <code class="docutils literal notranslate"><span class="pre">sep</span></code>)</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; The next three bytes (#FOREACH(31734,31735,31736)||n|#PEEKn|, | and ||)
; define the item locations.
 31734 DEFB 24,17,156
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#FOREACH</span></code> macro expands to ‘24, 17 and 156’.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">#FOREACH</span></code> macro recognises certain special variables, each one of which
expands to a specific sequence of strings. The special variables are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ENTRY[types]</span></code> - the addresses of every entry of the specified type(s) in
the memory map; if <code class="docutils literal notranslate"><span class="pre">types</span></code> is not given, every type is included</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EREFaddr</span></code> - the addresses of the routines that jump to or call a given
instruction (at <code class="docutils literal notranslate"><span class="pre">addr</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REFaddr</span></code> - the addresses of the routines that jump to or call a given
routine (at <code class="docutils literal notranslate"><span class="pre">addr</span></code>), or jump to or call any entry point within that routine</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; The messages can be found at #FOREACH(ENTRYt)||n|n|, | and ||.
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#FOREACH</span></code> macro expands to a list of the addresses of
the entries of type <code class="docutils literal notranslate"><span class="pre">t</span></code> (text).</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">s1,s2,...</span></code> and <code class="docutils literal notranslate"><span class="pre">var,string[,sep,fsep]</span></code> parameter strings.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>5.1</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="format">
<span id="id6"></span><h3>#FORMAT<a class="headerlink" href="#format" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#FORMAT</span></code> macro performs a Python-style <a class="reference external" href="https://docs.python.org/3/library/string.html#format-string-syntax">string formatting operation</a> on
its string argument.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#FORMAT[case](text)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">case</span></code> is 1 to convert the formatted string to lower case, 2 to convert it
to upper case, or 0 to leave it alone (the default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text</span></code> is the string to format</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#FORMAT(0x{count:04X})
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#FORMAT</span></code> macro formats the value of the <code class="docutils literal notranslate"><span class="pre">count</span></code>
variable (assuming it has already been defined by the <a class="reference internal" href="#let"><span class="std std-ref">#LET</span></a> macro) as a
4-digit upper case hexadecimal number prefixed by ‘0x’.</p>
<p>Note that if <code class="docutils literal notranslate"><span class="pre">text</span></code> could be read as an integer parameter, <code class="docutils literal notranslate"><span class="pre">case</span></code> should be
explicitly specified in order to prevent <code class="docutils literal notranslate"><span class="pre">text</span></code> from being interpreted as the
<code class="docutils literal notranslate"><span class="pre">case</span></code> parameter. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#FORMAT0({count})
</pre></div>
</div>
<p>Alternatively, the <a class="reference internal" href="#eval"><span class="std std-ref">#EVAL</span></a> macro may be a better option for formatting a
pure numeric value.</p>
<p>The parameters of the <code class="docutils literal notranslate"><span class="pre">#FORMAT</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">text</span></code> parameter.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.5</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">case</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>8.2</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="if">
<span id="id7"></span><h3>#IF<a class="headerlink" href="#if" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#IF</span></code> macro expands to an arbitrary string based on the truth value of an
arithmetic expression.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#IFexpr(true[,false])
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">expr</span></code> is the arithmetic expression, which may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">true</span></code> is the output string when <code class="docutils literal notranslate"><span class="pre">expr</span></code> is true</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">false</span></code> is the output string when <code class="docutils literal notranslate"><span class="pre">expr</span></code> is false (default: the empty
string)</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #FOR0,7(n,#IF(#PEEK47134 &amp; 2**(7-n))(X,O))
 47134 DEFB 170
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#IF</span></code> macro is used (in combination with a <code class="docutils literal notranslate"><span class="pre">#FOR</span></code>
macro and a <code class="docutils literal notranslate"><span class="pre">#PEEK</span></code> macro) to display the contents of the address 47134 in
the memory snapshot in binary format with ‘X’ for one and ‘O’ for zero:
XOXOXOXO.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">true</span></code> and <code class="docutils literal notranslate"><span class="pre">false</span></code> output strings.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>6.0</p></td>
<td><p>Added support for replacement fields in the <code class="docutils literal notranslate"><span class="pre">expr</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="let">
<span id="id8"></span><h3>#LET<a class="headerlink" href="#let" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#LET</span></code> macro defines an integer, string or dictionary variable.</p>
<p>The syntax for defining an integer or string variable is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#LET(name=value)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> is the variable name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> is the value to assign; this may contain skool macros (which are
expanded immediately) and <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>
(which are replaced after any skool macros have been expanded)</p></li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">name</span></code> ends with a dollar sign (<code class="docutils literal notranslate"><span class="pre">$</span></code>), <code class="docutils literal notranslate"><span class="pre">value</span></code> is interpreted as a
string. Otherwise <code class="docutils literal notranslate"><span class="pre">value</span></code> is evaluated as an arithmetic expression.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#LET(count=2*2)
#LET(count$=2*2)
</pre></div>
</div>
<p>These <code class="docutils literal notranslate"><span class="pre">#LET</span></code> macros assign the integer value ‘4’ to the variable <code class="docutils literal notranslate"><span class="pre">count</span></code> and
the string value ‘2*2’ to the variable <code class="docutils literal notranslate"><span class="pre">count$</span></code>. The variables are then
accessible to other macros via the replacement fields <code class="docutils literal notranslate"><span class="pre">{count}</span></code> and
<code class="docutils literal notranslate"><span class="pre">{count$}</span></code>.</p>
<p>The syntax for defining a dictionary variable is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#LET(name[]=(default[,k1[:v1],k2[:v2]...]))
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> is the dictionary variable name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code> is the default value (used when a key is not found in the
dictionary)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">k1:v1</span></code>, <code class="docutils literal notranslate"><span class="pre">k2:v2</span></code> etc. are the key-value pairs in the dictionary</p></li>
</ul>
<p>The keys in a dictionary are integers, and the associated values are strings if
<code class="docutils literal notranslate"><span class="pre">name</span></code> ends with a dollar sign, or integers otherwise. If the value part of a
key-value pair is omitted, it defaults to the key.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#LET(n[]=(0,1:10,2:20))
#LET(d$[]=(?,1:a,2:b))
</pre></div>
</div>
<p>The first <code class="docutils literal notranslate"><span class="pre">#LET</span></code> macro defines the dictionary variable <code class="docutils literal notranslate"><span class="pre">n</span></code> with default
integer value 0, and keys ‘1’ and ‘2’ mapping to the integer values 10 and 20.
The values in this dictionary are accessible to other macros via the replacement
fields <code class="docutils literal notranslate"><span class="pre">{n[1]}</span></code> and <code class="docutils literal notranslate"><span class="pre">{n[2]}</span></code>.</p>
<p>The second <code class="docutils literal notranslate"><span class="pre">#LET</span></code> macro defines the dictionary variable <code class="docutils literal notranslate"><span class="pre">d$</span></code> with default
string value ‘?’, and keys ‘1’ and ‘2’ mapping to the string values ‘a’ and
‘b’. The values in this dictionary are accessible to other macros via the
replacement fields <code class="docutils literal notranslate"><span class="pre">{d$[1]}</span></code> and <code class="docutils literal notranslate"><span class="pre">{d$[2]}</span></code>.</p>
<p>To define a variable that will be available for use immediately anywhere in the
skool file or ref files, consider using the <a class="reference internal" href="asm.html#expand"><span class="std std-ref">&#64;expand</span></a> directive.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
entire <code class="docutils literal notranslate"><span class="pre">name=value</span></code> parameter string, or the part after the equals sign when
defining a dictionary variable.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.6</p></td>
<td><p>Added the ability to define dictionary variables</p></td>
</tr>
<tr class="row-odd"><td><p>8.2</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="map">
<span id="id9"></span><h3>#MAP<a class="headerlink" href="#map" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#MAP</span></code> macro expands to a value from a map of key-value pairs whose keys
are integers.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#MAPkey(default[,k1:v1,k2:v2...])
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">key</span></code> is the integer to look up in the map; this parameter may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code> is the default output string (used when <code class="docutils literal notranslate"><span class="pre">key</span></code> is not found in
the map)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">k1:v1</span></code>, <code class="docutils literal notranslate"><span class="pre">k2:v2</span></code> etc. are the key-value pairs in the map</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; The next three bytes specify the directions that are available from here:
; #FOR56112,56114,,1(q,#MAP(#PEEKq)(?,0:left,1:right,2:up,3:down), , and ).
 56112 DEFB 0,1,3
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#MAP</span></code> macro is used (in combination with a <code class="docutils literal notranslate"><span class="pre">#FOR</span></code>
macro and a <code class="docutils literal notranslate"><span class="pre">#PEEK</span></code> macro) to display a list of directions available based on
the contents of addresses 56112-56114: ‘left, right and down’.</p>
<p>Note that the keys (<code class="docutils literal notranslate"><span class="pre">k1</span></code>, <code class="docutils literal notranslate"><span class="pre">k2</span></code> etc.) may be expressed using arithmetic
operations. They may also be expressed using skool macros, but in that case the
<em>entire</em> parameter string of the <code class="docutils literal notranslate"><span class="pre">#MAP</span></code> macro must be enclosed by a
<a class="reference internal" href="#hash"><span class="std std-ref">#()</span></a> macro.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
default output string and the key-value pairs.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>6.0</p></td>
<td><p>Added support for replacement fields in the <code class="docutils literal notranslate"><span class="pre">key</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pc">
<span id="id10"></span><h3>#PC<a class="headerlink" href="#pc" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#PC</span></code> macro expands to the address of the closest instruction in the
current entry.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#PC
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>c32768 XOR A ; This instruction is at #PC.
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#PC</span></code> macro expands to ‘32768’.</p>
<p>In an entry header (i.e. title, description, register description or start
comment), the <code class="docutils literal notranslate"><span class="pre">#PC</span></code> macro expands to the address of the first instruction in
the entry. In a mid-block comment, the <code class="docutils literal notranslate"><span class="pre">#PC</span></code> macro expands to the address of
the following instruction. In an instruction-level comment, the <code class="docutils literal notranslate"><span class="pre">#PC</span></code> macro
expands to the address of the instruction. In a block end comment, the <code class="docutils literal notranslate"><span class="pre">#PC</span></code>
macro expands to the address of the last instruction in the entry.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.0</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="peek">
<span id="id11"></span><h3>#PEEK<a class="headerlink" href="#peek" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#PEEK</span></code> macro expands to the contents of an address in the internal
memory snapshot constructed from the contents of the skool file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#PEEKaddr
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span></code> is the address, which may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a></p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; At the start of the game, the number of lives remaining is #PEEK33879.
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#PEEK</span></code> macro expands to the contents of the address
33879 in the internal memory snapshot.</p>
<p>See also <a class="reference internal" href="#pokes"><span class="std std-ref">#POKES</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.2</p></td>
<td><p>Added support for replacement fields in the <code class="docutils literal notranslate"><span class="pre">addr</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="str">
<span id="id12"></span><h3>#STR<a class="headerlink" href="#str" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#STR</span></code> macro expands to the text string at a given address in the memory
snapshot.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#STRaddr[,flags,length][(end)]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span></code> is the address of the first character in the string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flags</span></code> indicates operations to be performed on the string (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code> is the number of characters in the string; if -1 (the default),
the string ends immediately before the first zero byte, or on the first byte
that has bit 7 set (bit 7 of that byte will be reset before converting it to
a character), or when <code class="docutils literal notranslate"><span class="pre">end</span></code> evaluates to true</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">end</span></code> is an arithmetic expression that identifies the end marker byte for
the string (when bit 3 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> is set)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">flags</span></code> is the sum of the following values, chosen according to the desired
outcome:</p>
<ul class="simple">
<li><p>1 - strip trailing whitespace from the string</p></li>
<li><p>2 - strip leading whitespace from the string</p></li>
<li><p>4 - replace each sequence of N&gt;=2 spaces in the string with <code class="docutils literal notranslate"><span class="pre">#SPACE(N)</span></code>
(see <a class="reference internal" href="#space"><span class="std std-ref">#SPACE</span></a>)</p></li>
<li><p>8 - use the <code class="docutils literal notranslate"><span class="pre">end</span></code> parameter to determine where the string ends</p></li>
</ul>
<p>When bit 3 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> is set, <code class="docutils literal notranslate"><span class="pre">end</span></code> is evaluated for each byte encountered,
and if the result is true, the string is terminated. <code class="docutils literal notranslate"><span class="pre">end</span></code> may contain the
placeholder <code class="docutils literal notranslate"><span class="pre">$b</span></code> for the current byte value.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; The messages here are &#39;#STR47154&#39;, &#39;#STR47158&#39; and &#39;#STR47161,8($b==255)&#39;.
 47154 DEFM &quot;One&quot;,0
 47158 DEFM &quot;Tw&quot;,&quot;o&quot;+128
 47161 DEFM &quot;Three&quot;,255
</pre></div>
</div>
<p>These instances of the <code class="docutils literal notranslate"><span class="pre">#STR</span></code> macro expand to ‘One’, ‘Two’ and ‘Three’.</p>
<p>The parameters of the <code class="docutils literal notranslate"><span class="pre">#STR</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.6</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="while">
<span id="id13"></span><h3>#WHILE<a class="headerlink" href="#while" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#WHILE</span></code> macro repeatedly expands macros while a conditional expression
is true.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#WHILE(expr)(body)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">expr</span></code> is the conditional expression</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">body</span></code> is the text to repeatedly expand; leading and trailing whitespace
are stripped from the expanded value</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#LET(a=3)
#WHILE({a}&gt;0)(
  #EVAL({a})
  #LET(a={a}-1)
)
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#WHILE</span></code> macro expands to ‘321’.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">expr</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">#WHILE</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">body</span></code> parameter.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.6</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="general-macros">
<h2>General macros<a class="headerlink" href="#general-macros" title="Permalink to this heading">¶</a></h2>
<section id="audio">
<span id="id14"></span><h3>#AUDIO<a class="headerlink" href="#audio" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#AUDIO</span></code> macro expands to an HTML5 <code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code> element.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#AUDIO[flags,offset](fname)[(delays)]
</pre></div>
</div>
<p>Or, when executing code in a simulator (bit 2 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> set):</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#AUDIO[flags,offset](fname)(start,stop[,execint,cmio])
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">flags</span></code> controls various options (see below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">offset</span></code> is the initial offset in T-states from the start of a frame
(default: 0); this value affects when contention and interrupt delays (if
enabled) first take effect</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fname</span></code> is the name of the audio file</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delays</span></code> is a comma-separated list of delays (in T-states) between speaker
state changes; this parameter may contain skool macros (which are expanded
first) and <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a> (which are replaced
after any skool macros have been expanded)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> is the address at which to start executing code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code> is the address at which to stop executing code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">execint</span></code> specifies whether to execute interrupt routines (1), or ignore
interrupts (0, the default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmio</span></code> specifies whether memory and I/O contention are simulated (1), or
not simulated (0, the default)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">flags</span></code> is the sum of the following values, chosen according to the desired
outcome:</p>
<ul class="simple">
<li><p>1 (bit 0) - modify delays to approximate the effect of running in contended
memory; this increases any delays that occur during the contended period of a
frame by a given factor (as specified by the <code class="docutils literal notranslate"><span class="pre">ContentionBegin</span></code>,
<code class="docutils literal notranslate"><span class="pre">ContentionEnd</span></code> and <code class="docutils literal notranslate"><span class="pre">ContentionFactor</span></code> parameters in the
<a class="reference internal" href="ref-files.html#ref-audiowriter"><span class="std std-ref">[AudioWriter]</span></a> section)</p></li>
<li><p>2 (bit 1) - modify delays as if interrupts were enabled; this increases any
delays that occur over a frame boundary by a given number of T-states (as
specified by the <code class="docutils literal notranslate"><span class="pre">InterruptDelay</span></code> parameter in the <a class="reference internal" href="ref-files.html#ref-audiowriter"><span class="std std-ref">[AudioWriter]</span></a>
section)</p></li>
<li><p>4 (bit 2) - execute instructions from <code class="docutils literal notranslate"><span class="pre">start</span></code> to <code class="docutils literal notranslate"><span class="pre">stop</span></code> in a simulator to
obtain the delays between speaker state changes</p></li>
<li><p>8 (bit 3) - pass delays through a moving average filter; while this can
produce higher quality audio (especially for multi-channel tunes), it is
slower than the default sampling algorithm</p></li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">execint</span></code> is set to 1, make sure that bit 1 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> is 0, otherwise
interrupt delays may be applied twice: once during execution of the code, and
again in post-processing. Similarly, if <code class="docutils literal notranslate"><span class="pre">cmio</span></code> is set to 1, make sure that
bit 0 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> is 0, otherwise memory and I/O contention delays may be
applied twice.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">fname</span></code> starts with a ‘/’, the filename is taken to be relative to the
root of the HTML disassembly. Otherwise the filename is taken to be relative to
the audio directory (as defined by the <code class="docutils literal notranslate"><span class="pre">AudioPath</span></code> parameter in the
<a class="reference internal" href="ref-files.html#paths"><span class="std std-ref">[Paths]</span></a> section).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">delays</span></code> is specified and <code class="docutils literal notranslate"><span class="pre">fname</span></code> ends with ‘.wav’, a corresponding
audio file in WAV format is created. Each element in <code class="docutils literal notranslate"><span class="pre">delays</span></code> can be an
integer, a list or tuple of integers, or a list/tuple of lists/tuples of
integers etc. nested to arbitrary depth, expressed as Python literals. For
example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1000, [1500]*100, [(800, 1200)*2, 900]*200
</pre></div>
</div>
<p>This would be flattened into a list of integers, as follows:</p>
<ul class="simple">
<li><p>a single instance of ‘1000’</p></li>
<li><p>100 instances of ‘1500’</p></li>
<li><p>200 instances of the sequence ‘800, 1200, 800, 1200, 900’</p></li>
</ul>
<p>The sum of this list of integers being 1131000, this would result in an audio
file of duration 1131000 / 3500000 = 0.323s (assuming that no memory contention
is simulated and interrupts are disabled, i.e. bits 0 and 1 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> are
reset).</p>
<p>The characters allowed in the <code class="docutils literal notranslate"><span class="pre">delays</span></code> parameter are ‘ ‘ (space), newline,
the digits 0-9, and any of <code class="docutils literal notranslate"><span class="pre">,*+-%()[]</span></code>.</p>
<p>An alternative to supplying the delay values manually is to execute the code
that produces the sound effect in a simulator, and let the simulator compute
the delays. This can be done by setting bit 2 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> and specifying the
code to execute via the <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">stop</span></code> address parameters. For
example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #AUDIO4(beep.wav)(32768,32782)
c32768 LD L,0
*32771 OUT (254),A
 32773 XOR 16
 32775 LD B,200
 32777 DJNZ 32777
 32779 DEC L
 32780 JR NZ,32771
 32782 RET
</pre></div>
</div>
<p>Before executing code in a simulator, the <code class="docutils literal notranslate"><span class="pre">#AUDIO</span></code> macro copies the simulator
state as it was left by the most recent invocation of either the <code class="docutils literal notranslate"><span class="pre">#AUDIO</span></code> or
the <a class="reference internal" href="#sim"><span class="std std-ref">#SIM</span></a> macro (if any).</p>
<p>Note that code executed by the <code class="docutils literal notranslate"><span class="pre">#AUDIO</span></code> macro operates directly on the
internal memory snapshot, and therefore can modify it. To avoid that, use the
<a class="reference internal" href="#pushs"><span class="std std-ref">#PUSHS</span></a> and <a class="reference internal" href="#pops"><span class="std std-ref">#POPS</span></a> macros to operate on a copy of the snapshot.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">delays</span></code> or <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">stop</span></code> parameters are specified, but <code class="docutils literal notranslate"><span class="pre">fname</span></code>
does not end with ‘.wav’, no audio file is written. This enables the parameters
to be kept in place as a reminder of how an original WAV file was created by
the <code class="docutils literal notranslate"><span class="pre">#AUDIO</span></code> macro before it was converted to another format.</p>
<p>If neither <code class="docutils literal notranslate"><span class="pre">delays</span></code> nor <code class="docutils literal notranslate"><span class="pre">start</span></code> and <code class="docutils literal notranslate"><span class="pre">stop</span></code> parameters are specified, or
<code class="docutils literal notranslate"><span class="pre">fname</span></code> does not end with ‘.wav’, the named audio file must already exist in
the specified location, otherwise the <code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code> element controls will not
work. To make sure that a pre-built audio file is copied into the desired
location when <a class="reference internal" href="commands.html#skool2html-py"><span class="std std-ref">skool2html.py</span></a> is run, it can be declared in the
<a class="reference internal" href="ref-files.html#resources"><span class="std std-ref">[Resources]</span></a> section.</p>
<p>By default, if <code class="docutils literal notranslate"><span class="pre">fname</span></code> ends with ‘.wav’, but a ‘.flac’, ‘.mp3’ or ‘.ogg’ file
with the same basename already exists, that file is used and no WAV file is
written. This enables an original WAV file to be replaced by an alternative
(compressed) version without having to modify the <code class="docutils literal notranslate"><span class="pre">fname</span></code> parameter of the
<code class="docutils literal notranslate"><span class="pre">#AUDIO</span></code> macro. The alternative audio file types that the <code class="docutils literal notranslate"><span class="pre">#AUDIO</span></code> macro
looks for before writing a WAV file are specified by the <code class="docutils literal notranslate"><span class="pre">AudioFormats</span></code>
parameter in the <a class="reference internal" href="ref-files.html#ref-game"><span class="std std-ref">[Game]</span></a> section.</p>
<p>The integer parameters (i.e. all except <code class="docutils literal notranslate"><span class="pre">fname</span></code> and <code class="docutils literal notranslate"><span class="pre">delays</span></code>) of the
<code class="docutils literal notranslate"><span class="pre">#AUDIO</span></code> macro may contain <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>The <a class="reference internal" href="html-templates.html#t-audio"><span class="std std-ref">audio</span></a> template is used to format the <code class="docutils literal notranslate"><span class="pre">&lt;audio&gt;</span></code> element.</p>
<p>Audio file creation can be configured via the <a class="reference internal" href="ref-files.html#ref-audiowriter"><span class="std std-ref">[AudioWriter]</span></a> section.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>9.1</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">cmio</span></code> and <code class="docutils literal notranslate"><span class="pre">execint</span></code> parameters; added support for
executing code in a 128K memory snapshot</p></td>
</tr>
<tr class="row-odd"><td><p>9.0</p></td>
<td><p>Added support for passing delays through a moving average filter</p></td>
</tr>
<tr class="row-even"><td><p>8.7</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="bank">
<span id="id15"></span><h3>#BANK<a class="headerlink" href="#bank" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#BANK</span></code> macro switches the RAM bank that is mapped to 49152-65535
(0xC000-0xFFFF) in the memory snapshot:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#BANKpage
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">page</span></code> is the page number (0-7)</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; This is the UDG at 50000 in RAM bank 6: #BANK6 #UDG50000(udg)
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#BANK</span></code> macro maps RAM bank 6 to 49152-65535 in
preparation for creating an image of the UDG at 50000 in that RAM bank.</p>
<p>If the memory snapshot hasn’t already been converted from 48K to 128K by a
<a class="reference internal" href="asm.html#asm-bank"><span class="std std-ref">&#64;bank</span></a> directive, it will be converted when the first <code class="docutils literal notranslate"><span class="pre">#BANK</span></code> macro
in the skool file is expanded.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>9.1</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="call">
<span id="id16"></span><h3>#CALL<a class="headerlink" href="#call" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#CALL</span></code> macro expands to the return value of a method on
the <cite>HtmlWriter</cite> class or subclass that is being used to create the HTML
disassembly (as defined by the <code class="docutils literal notranslate"><span class="pre">HtmlWriterClass</span></code> parameter in the
<a class="reference internal" href="ref-files.html#ref-config"><span class="std std-ref">[Config]</span></a> section of the ref file).</p>
<p>In ASM mode, the <code class="docutils literal notranslate"><span class="pre">#CALL</span></code> macro expands to the return value of a method on the
<cite>AsmWriter</cite> class or subclass that is being used to generate the ASM output (as
defined by the <a class="reference internal" href="asm.html#writer"><span class="std std-ref">&#64;writer</span></a> ASM directive in the skool file).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#CALL:methodName(args)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">methodName</span></code> is the name of the method to call</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">args</span></code> is a comma-separated list of arguments to pass to the method, which
may contain <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a></p></li>
</ul>
<p>Each argument can be expressed either as a plain value (e.g. <code class="docutils literal notranslate"><span class="pre">32768</span></code>) or as a
keyword argument (e.g. <code class="docutils literal notranslate"><span class="pre">address=32768</span></code>).</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; The word at address 32768 is #CALL:word(32768).
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#CALL</span></code> macro expands to the return value of the <cite>word</cite>
method (on the <cite>HtmlWriter</cite> or <cite>AsmWriter</cite> subclass being used) when called
with the argument <code class="docutils literal notranslate"><span class="pre">32768</span></code>.</p>
<p>For information on writing methods that may be called by a <code class="docutils literal notranslate"><span class="pre">#CALL</span></code> macro, see
the documentation on <a class="reference internal" href="extending.html#extendingskoolkit"><span class="std std-ref">extending SkoolKit</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the <code class="docutils literal notranslate"><span class="pre">args</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>8.1</p></td>
<td><p>Added support for keyword arguments</p></td>
</tr>
<tr class="row-even"><td><p>5.1</p></td>
<td><p>Added support for arithmetic expressions and skool macros in the
<code class="docutils literal notranslate"><span class="pre">args</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>3.1</p></td>
<td><p>Added support for ASM mode</p></td>
</tr>
<tr class="row-even"><td><p>2.1</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="chr">
<span id="id17"></span><h3>#CHR<a class="headerlink" href="#chr" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#CHR</span></code> macro expands either to a numeric character
reference, or to a unicode character in the UTF-8 encoding. In ASM mode, it
always expands to a unicode character in the UTF-8 encoding.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#CHRnum[,flags]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">num</span></code> is the character code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flags</span></code> enables options that control the output (default: 0)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">flags</span></code> is the sum of the following values, chosen according to the desired
outcome:</p>
<ul class="simple">
<li><p>1 - produce a character in the UTF-8 encoding instead of a numeric character
reference in HTML mode</p></li>
<li><p>2 - map character code 94 to 8593 (’↑’), 96 to 163 (’£’), and 127 to 169
(’©’), in accordance with the ZX Spectrum character set</p></li>
</ul>
<p>For example:</p>
<div class="nonexistent highlight-none notranslate"><div class="highlight"><pre><span></span> 26751 DEFB 127   ; This is the copyright symbol: #CHR169
 26572 DEFB 127   ; This is also the copyright symbol: #CHR127,2
</pre></div>
</div>
<p>In HTML mode, these instances of the <code class="docutils literal notranslate"><span class="pre">#CHR</span></code> macro expand to ‘&amp;#169;’. In ASM
mode, they both expand to ‘©’.</p>
<p>The parameter string of the <code class="docutils literal notranslate"><span class="pre">#CHR</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.6</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">flags</span></code> parameter, the ability to use UTF-8 encoding
in HTML mode, and support for mapping character codes 94, 96 and
127 to ‘↑’, ‘£’  and ‘©’</p></td>
</tr>
<tr class="row-odd"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the parameter string</p></td>
</tr>
<tr class="row-even"><td><p>5.1</p></td>
<td><p>Added support for arithmetic expressions and skool macros in the
parameter string</p></td>
</tr>
<tr class="row-odd"><td><p>3.1</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="d">
<span id="id18"></span><h3>#D<a class="headerlink" href="#d" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#D</span></code> macro expands to the title of an entry (a routine or data block) in
the memory map.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#Daddr
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span></code> is the address of the entry, which may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a></p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; Now we make an indirect jump to one of the following routines:
; .
; #TABLE(default,centre)
; { =h Address | =h Description }
; { #R27126    | #D27126 }
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#D</span></code> macro expands to the title of the routine at 27126.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the <code class="docutils literal notranslate"><span class="pre">addr</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>Added support for arithmetic expressions and skool macros in the
<code class="docutils literal notranslate"><span class="pre">addr</span></code> parameter</p></td>
</tr>
</tbody>
</table>
</section>
<section id="html">
<span id="id19"></span><h3>#HTML<a class="headerlink" href="#html" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#HTML</span></code> macro expands to arbitrary text (in HTML mode) or to an empty
string (in ASM mode).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#HTML(text)
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">#HTML</span></code> macro may be used to render HTML (which would otherwise be
escaped) from a skool file. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #HTML(For more information, go &lt;a href=&quot;http://example.com/&quot;&gt;here&lt;/a&gt;.)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">text</span></code> may contain other skool macros, which will be expanded before
rendering. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #HTML[The UDG defined here (32768) looks like this: #UDG32768,4,1]
</pre></div>
</div>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">text</span></code> parameter. Note that if an alternative delimiter is used, it must not
be an upper case letter.</p>
<p>See also <a class="reference internal" href="#udgtable"><span class="std std-ref">#UDGTABLE</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>3.1.2</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="include">
<span id="id20"></span><h3>#INCLUDE<a class="headerlink" href="#include" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#INCLUDE</span></code> macro expands to the contents of one or more ref
file sections. In ASM mode, it expands to an empty string.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#INCLUDE[paragraphs](pattern)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">paragraphs</span></code> specifies how to format the contents of the ref file sections:
verbatim (0 - the default), or into paragraphs (1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pattern</span></code> is a regular expression pattern that identifies the names of the
ref file sections to include</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">#INCLUDE</span></code> macro can be used to insert the contents of one ref file
section into another. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[MemoryMap:RoutinesMap]
Intro=#INCLUDE(RoutinesMapIntro)

[RoutinesMapIntro]
This is the intro to the &#39;Routines&#39; map page.
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">pattern</span></code> identifies multiple ref file sections, they are concatenated in
the order in which they appear in the ref file.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">paragraphs</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">#INCLUDE</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">pattern</span></code> parameter.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.6</p></td>
<td><p>Added the ability to combine multiple ref file sections</p></td>
</tr>
<tr class="row-odd"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the <code class="docutils literal notranslate"><span class="pre">paragraphs</span></code>
parameter</p></td>
</tr>
<tr class="row-even"><td><p>5.3</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="link">
<span id="id21"></span><h3>#LINK<a class="headerlink" href="#link" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#LINK</span></code> macro expands to a hyperlink (<code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code> element) to
another page.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#LINK:PageId[#name](link text)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">PageId</span></code> is the ID of the page to link to</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> is the name of an anchor on the page to link to</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">text</span></code> is the link text to use</p></li>
</ul>
<p>In HTML mode, if the link text is blank, it defaults either to the title of the
entry being linked to (if the page is a <a class="reference internal" href="ref-files.html#boxpages"><span class="std std-ref">box page</span></a> and contains
an entry with the specified anchor), or to the page’s link text.</p>
<p>In ASM mode, the <code class="docutils literal notranslate"><span class="pre">#LINK</span></code> macro expands to the link text.</p>
<p>The page IDs that may be used are the same as the file IDs that may be used in
the <a class="reference internal" href="ref-files.html#paths"><span class="std std-ref">[Paths]</span></a> section of a ref file, or the page IDs defined by <a class="reference internal" href="ref-files.html#page"><span class="std std-ref">[Page:*]</span></a>
sections.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; See the #LINK:Glossary(glossary) for a definition of &#39;chuntey&#39;.
</pre></div>
</div>
<p>In HTML mode, this instance of the <code class="docutils literal notranslate"><span class="pre">#LINK</span></code> macro expands to a hyperlink to
the ‘Glossary’ page, with link text ‘glossary’.</p>
<p>In ASM mode, this instance of the <code class="docutils literal notranslate"><span class="pre">#LINK</span></code> macro expands to ‘glossary’.</p>
<p>To create a hyperlink to an entry on a memory map page, use the address of the
entry as the anchor. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; Now we update the #LINK:GameStatusBuffer#40000(number of lives).
</pre></div>
</div>
<p>In HTML mode, the anchor of this <code class="docutils literal notranslate"><span class="pre">#LINK</span></code> macro (40000) is converted to the
format specified by the <code class="docutils literal notranslate"><span class="pre">AddressAnchor</span></code> parameter in the <a class="reference internal" href="ref-files.html#ref-game"><span class="std std-ref">[Game]</span></a>
section.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>5.4</p></td>
<td><p>When linking to an entry on a <a class="reference internal" href="ref-files.html#boxpages"><span class="std std-ref">box page</span></a>, the
link text, if left blank, defaults to the title of the entry (in
HTML mode)</p></td>
</tr>
<tr class="row-odd"><td><p>5.2</p></td>
<td><p>An entry address anchor in a link to a memory map page is
converted to the format specified by the <code class="docutils literal notranslate"><span class="pre">AddressAnchor</span></code>
parameter</p></td>
</tr>
<tr class="row-even"><td><p>3.1.3</p></td>
<td><p>If left blank, the link text defaults to the page’s link text in
HTML mode</p></td>
</tr>
<tr class="row-odd"><td><p>2.1</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="list">
<span id="id22"></span><h3>#LIST<a class="headerlink" href="#list" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#LIST</span></code> macro marks the beginning of a list of bulleted items; <code class="docutils literal notranslate"><span class="pre">LIST#</span></code>
is used to mark the end. Between these markers, the list items are defined.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#LIST[(class[,bullet])][&lt;flag&gt;][items]LIST#
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">class</span></code> is the CSS class to use for the <code class="docutils literal notranslate"><span class="pre">&lt;ul&gt;</span></code> element</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bullet</span></code> is the bullet character to use in ASM mode</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flag</span></code> is the wrap flag (see below)</p></li>
</ul>
<p>Each item in a list must start with <code class="docutils literal notranslate"><span class="pre">{</span></code> followed by a space, and end with
<code class="docutils literal notranslate"><span class="pre">}</span></code> preceded by a space.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #LIST(data)
; { Item 1 }
; { Item 2 }
; LIST#
</pre></div>
</div>
<p>This list has two items, and will have the CSS class ‘data’.</p>
<p>In ASM mode, lists are rendered as plain text, with each item on its own line,
and an asterisk as the bullet character. The bullet character can be changed
for all lists by using a <a class="reference internal" href="asm.html#set"><span class="std std-ref">&#64;set</span></a> directive to set the <code class="docutils literal notranslate"><span class="pre">bullet</span></code> property,
or it can be changed for a specific list by setting the <code class="docutils literal notranslate"><span class="pre">bullet</span></code> parameter.</p>
<p>The wrap flag (<code class="docutils literal notranslate"><span class="pre">flag</span></code>), if present, determines how <a class="reference internal" href="commands.html#sna2skool-py"><span class="std std-ref">sna2skool.py</span></a> will
write list items when reading from a control file. Supported values are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nowrap</span></code> - write each list item on a single line</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wrapalign</span></code> - wrap each list item with an indent at the start of the second
and subsequent lines to maintain text alignment with the first line</p></li>
</ul>
<p>By default, each list item is wrapped over multiple lines with no indent.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>7.2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#LIST</span></code> can be used in register descriptions in ASM mode</p></td>
</tr>
<tr class="row-odd"><td><p>7.0</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">nowrap</span></code> and <code class="docutils literal notranslate"><span class="pre">wrapalign</span></code> flags</p></td>
</tr>
<tr class="row-even"><td><p>6.4</p></td>
<td><p>In ASM mode: <code class="docutils literal notranslate"><span class="pre">#LIST</span></code> can be used in an instruction-level
comment and as a parameter of another macro; if the bullet
character is an empty string, list items are no longer indented
by one space; added the <code class="docutils literal notranslate"><span class="pre">bullet</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>3.2</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="n">
<span id="id23"></span><h3>#N<a class="headerlink" href="#n" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#N</span></code> macro renders a numeric value in either decimal or hexadecimal
format depending on the options used with <a class="reference internal" href="commands.html#skool2asm-py"><span class="std std-ref">skool2asm.py</span></a> or
<a class="reference internal" href="commands.html#skool2html-py"><span class="std std-ref">skool2html.py</span></a>. A hexadecimal number is rendered in lower case when the
<code class="docutils literal notranslate"><span class="pre">--lower</span></code> option is used, or in upper case otherwise.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#Nvalue[,hwidth,dwidth,affix,hex][(prefix[,suffix])]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> is the numeric value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hwidth</span></code> is the minimum number of digits printed in hexadecimal output
(default: 2 for values &lt; 256, or 4 otherwise)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dwidth</span></code> is the minimum number of digits printed in decimal output
(default: 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">affix</span></code> is 1 if <code class="docutils literal notranslate"><span class="pre">prefix</span></code> or <code class="docutils literal notranslate"><span class="pre">suffix</span></code> is specified, 0 if not (default:
0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hex</span></code> is 1 to render the value in hexadecimal format unless the
<code class="docutils literal notranslate"><span class="pre">--decimal</span></code> option is used, or 0 to render it in decimal format unless the
<code class="docutils literal notranslate"><span class="pre">--hex</span></code> option is used (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prefix</span></code> is the prefix for a hexadecimal number (default: empty string)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">suffix</span></code> is the suffix for a hexadecimal number (default: empty string)</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#N15,4,5,1(0x)
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#N</span></code> macro expands to one of the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">00015</span></code> (when <code class="docutils literal notranslate"><span class="pre">--hex</span></code> is not used)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x000F</span></code> (when <code class="docutils literal notranslate"><span class="pre">--hex</span></code> is used without <code class="docutils literal notranslate"><span class="pre">--lower</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">0x000f</span></code> (when both <code class="docutils literal notranslate"><span class="pre">--hex</span></code> and <code class="docutils literal notranslate"><span class="pre">--lower</span></code> are used)</p></li>
</ul>
<p>The integer parameters of the <code class="docutils literal notranslate"><span class="pre">#N</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">prefix</span></code> and <code class="docutils literal notranslate"><span class="pre">suffix</span></code> parameters.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the integer parameters</p></td>
</tr>
<tr class="row-odd"><td><p>6.2</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">hex</span></code> parameter</p></td>
</tr>
<tr class="row-even"><td><p>5.2</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="r">
<span id="id24"></span><h3>#R<a class="headerlink" href="#r" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#R</span></code> macro expands to a hyperlink (<code class="docutils literal notranslate"><span class="pre">&lt;a&gt;</span></code> element) to the
disassembly page for a routine or data block, or to a line at a given address
within that page.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#Raddr[@code][#name][(link text)]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span></code> is the address of the routine or data block (or entry point
thereof), which may contain <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">code</span></code> is the ID of the disassembly that contains the routine or data block
(if not given, the current disassembly is assumed; otherwise this must be
either an ID defined in an <a class="reference internal" href="ref-files.html#othercode"><span class="std std-ref">[OtherCode:*]</span></a> section of the ref file, or
<code class="docutils literal notranslate"><span class="pre">main</span></code> to identify the main disassembly)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#name</span></code> is the named anchor of an item on the disassembly page</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">link</span> <span class="pre">text</span></code> is the link text to use</p></li>
</ul>
<p>The disassembly ID (<code class="docutils literal notranslate"><span class="pre">code</span></code>) and anchor name (<code class="docutils literal notranslate"><span class="pre">name</span></code>) must be limited to the
characters ‘$’, ‘#’, 0-9, A-Z and a-z.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">link_text</span></code> is not provided, it defaults to the label for <code class="docutils literal notranslate"><span class="pre">addr</span></code> if one
is defined, or to the address formatted according to the <code class="docutils literal notranslate"><span class="pre">Address</span></code> parameter
in the <a class="reference internal" href="ref-files.html#ref-game"><span class="std std-ref">[Game]</span></a> section.</p>
<p>In ASM mode, the <code class="docutils literal notranslate"><span class="pre">#R</span></code> macro expands to the link text if it is specified, or
to the label for <code class="docutils literal notranslate"><span class="pre">addr</span></code>, or to <code class="docutils literal notranslate"><span class="pre">addr</span></code> (converted to decimal or hexadecimal
as appropriate) if no label is found.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; Prepare for a new game
;
; Used by the routine at #R25820.
</pre></div>
</div>
<p>In HTML mode, this instance of the <code class="docutils literal notranslate"><span class="pre">#R</span></code> macro expands to a hyperlink to the
disassembly page for the routine at 25820.</p>
<p>In ASM mode, this instance of the <code class="docutils literal notranslate"><span class="pre">#R</span></code> macro expands to the label for the
routine at 25820 (or simply <code class="docutils literal notranslate"><span class="pre">25820</span></code> if that routine has no label).</p>
<p>To create a hyperlink to the first instruction in a routine or data block, use
an anchor that evaluates to the address of that instruction. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; See the #R40000#40000(first item) in the data table at 40000.
</pre></div>
</div>
<p>In HTML mode, the anchor of this <code class="docutils literal notranslate"><span class="pre">#R</span></code> macro (40000) is converted to the
format specified by the <code class="docutils literal notranslate"><span class="pre">AddressAnchor</span></code> parameter in the <a class="reference internal" href="ref-files.html#ref-game"><span class="std std-ref">[Game]</span></a>
section.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.4</p></td>
<td><p>In HTML mode, the link text defaults to the address formatted
according to the <code class="docutils literal notranslate"><span class="pre">Address</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the <code class="docutils literal notranslate"><span class="pre">addr</span></code> parameter</p></td>
</tr>
<tr class="row-even"><td><p>6.1</p></td>
<td><p>In ASM mode, <code class="docutils literal notranslate"><span class="pre">addr</span></code> is converted to decimal or hexadecimal as
appropriate even when it refers to an unavailable instruction</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>An anchor that matches the entry address is converted to the
format specified by the <code class="docutils literal notranslate"><span class="pre">AddressAnchor</span></code> parameter; added
support for arithmetic expressions and skool macros in the
<code class="docutils literal notranslate"><span class="pre">addr</span></code> parameter</p></td>
</tr>
<tr class="row-even"><td><p>3.5</p></td>
<td><p>Added the ability to resolve (in HTML mode) the address of an
entry point in another disassembly when an appropriate
<a class="reference internal" href="asm.html#remote"><span class="std std-ref">remote entry</span></a> is defined</p></td>
</tr>
<tr class="row-odd"><td><p>2.0</p></td>
<td><p>Added support for the <code class="docutils literal notranslate"><span class="pre">&#64;code</span></code> notation</p></td>
</tr>
</tbody>
</table>
</section>
<section id="raw">
<span id="id25"></span><h3>#RAW<a class="headerlink" href="#raw" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#RAW</span></code> macro expands to the exact value of its sole string argument,
leaving any other macros (or macro-like tokens) it contains unexpanded.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#RAW(text)
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; See the routine at #RAW(#BEEF).
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#RAW</span></code> macro expands to ‘#BEEF’.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">text</span></code> parameter. Note that if an alternative delimiter is used, it must not
be an upper case letter.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>6.4</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="reg">
<span id="id26"></span><h3>#REG<a class="headerlink" href="#reg" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#REG</span></code> macro expands to a styled <code class="docutils literal notranslate"><span class="pre">&lt;span&gt;</span></code> element
containing a register name or arbitrary text (with case adjusted as
appropriate).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#REGreg
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">reg</span></code> is the name of the register, or:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#REG(text)
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">text</span></code> is arbitrary text (e.g. <code class="docutils literal notranslate"><span class="pre">hlh'l'</span></code>).</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">text</span></code> parameter. Note that if an alternative delimiter is used, it must not
be a letter.</p>
<p>In ASM mode, the <code class="docutils literal notranslate"><span class="pre">#REG</span></code> macro expands to either <code class="docutils literal notranslate"><span class="pre">reg</span></code> or <code class="docutils literal notranslate"><span class="pre">text</span></code> (with
case adjusted as appropriate).</p>
<p>The register name (<code class="docutils literal notranslate"><span class="pre">reg</span></code>) must be one of the following:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>a b c d e f h l
a&#39; b&#39; c&#39; d&#39; e&#39; f&#39; h&#39; l&#39;
af bc de hl
af&#39; bc&#39; de&#39; hl&#39;
ix iy ixh iyh ixl iyl
i r sp pc
</pre></div>
</div>
<p>For example:</p>
<div class="nonexistent highlight-none notranslate"><div class="highlight"><pre><span></span> 24623 LD C,31       ; #REGbc&#39;=31
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>5.4</p></td>
<td><p>Added support for an arbitrary text parameter</p></td>
</tr>
<tr class="row-odd"><td><p>5.3</p></td>
<td><p>Added support for the F and F’ registers</p></td>
</tr>
<tr class="row-even"><td><p>5.1</p></td>
<td><p>The <code class="docutils literal notranslate"><span class="pre">reg</span></code> parameter must be a valid register name</p></td>
</tr>
</tbody>
</table>
</section>
<section id="sim">
<span id="id27"></span><h3>#SIM<a class="headerlink" href="#sim" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#SIM</span></code> macro simulates the execution of machine code in the internal
memory snapshot constructed from the contents of the skool file.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SIM[stop,start,clear,a,f,bc,de,hl,xa,xf,xbc,xde,xhl,ix,iy,i,r,sp,execint,tstates,iff,im,cmio]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code> is the address at which to stop execution; if not given, no code is
executed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> is the address at which to start execution (default: <code class="docutils literal notranslate"><span class="pre">stop</span></code> from
the previous invocation of the <code class="docutils literal notranslate"><span class="pre">#SIM</span></code> macro, or 0 if this is the first run)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">clear</span></code> is 0 to use the register values that resulted from the previous
invocation of the <code class="docutils literal notranslate"><span class="pre">#SIM</span></code> macro (the default), or 1 to reset them to their
default values (shown below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">a</span></code> sets the value of the A (accumulator) register (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">f</span></code> sets the value of the F (flags) register (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bc</span></code> sets the value of the BC register pair (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">de</span></code> sets the value of the DE register pair (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">hl</span></code> sets the value of the HL register pair (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xa</span></code> sets the value of the A’ (shadow accumulator) register (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xf</span></code> sets the value of the F’ (shadow flags) register (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xbc</span></code> sets the value of the shadow BC register pair (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xde</span></code> sets the value of the shadow DE register pair (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xhl</span></code> sets the value of the shadow HL register pair (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ix</span></code> sets the value of the IX register (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iy</span></code> sets the value of the IY register (default: 23610)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">i</span></code> sets the value of the I register (default: 63)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">r</span></code> sets the value of the R register (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sp</span></code> sets the value of the stack pointer (default: 23552)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">execint</span></code> specifies whether to execute interrupt routines (1), or ignore
interrupts (0, the default)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tstates</span></code> sets the value of the simulator’s clock (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iff</span></code> sets whether interrupts are disabled (0, the default) or enabled (1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">im</span></code> sets the interrupt mode (default: 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmio</span></code> specifies whether memory and I/O contention are simulated (1), or
not simulated (0, the default)</p></li>
</ul>
<p>The parameters of the <code class="docutils literal notranslate"><span class="pre">#SIM</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a> and may also be given as keyword
arguments.</p>
<p>When execution stops, the simulator’s register values are copied to the <code class="docutils literal notranslate"><span class="pre">sim</span></code>
dictionary, where they are accessible via replacement fields with the following
names:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sim[A]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[F]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[BC]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[DE]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[HL]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[^A]</span></code> - the shadow A register</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[^F]</span></code> - the shadow flags register</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[^BC]</span></code> - the shadow BC register pair</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[^DE]</span></code> - the shadow DE register pair</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[^HL]</span></code> - the shadow HL register pair</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[IX]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[IY]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[I]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[R]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[SP]</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[PC]</span></code> - the program counter (equal to <code class="docutils literal notranslate"><span class="pre">stop</span></code>); this is used as the
default value of <code class="docutils literal notranslate"><span class="pre">start</span></code> for the next invocation of the <code class="docutils literal notranslate"><span class="pre">#SIM</span></code> macro</p></li>
</ul>
<p>In addition, the simulator’s hardware state is copied to the <code class="docutils literal notranslate"><span class="pre">sim</span></code>
dictionary, where it is accessible via replacement fields with the following
names:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sim[7ffd]</span></code> - the value of the last OUT to port 0x7ffd</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[ay][N]</span></code> - the value of AY register N (0-15)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[fffd]</span></code> - the value of the last OUT to port 0xfffd</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[halted]</span></code> - 1 if the simulated CPU is halted, 0 otherwise</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[iff]</span></code> - 0 if interrupts are disabled, 1 if they’re enabled</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[im]</span></code> - interrupt mode (0, 1 or 2)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sim[tstates]</span></code> - the number of T-states elapsed</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #SIM(start=32768,stop=32772,bc=13256,de=672)
 32768 LD HL,443
 32771 ADD HL,BC
; At this point HL=#EVAL({sim[HL]}).
; #SIM(32773)
 32772 ADD HL,DE
; And now HL=#EVAL({sim[HL]}).
 32773 RET
</pre></div>
</div>
<p>The first <code class="docutils literal notranslate"><span class="pre">#SIM</span></code> macro initialises the BC and DE register pairs to 13256 and
672 respectively, starts executing code at 32768, and stops when it reaches the
‘ADD HL,DE’ instruction at 32772. The second <code class="docutils literal notranslate"><span class="pre">#SIM</span></code> macro picks up execution
where the first left off, and stops when it reaches the ‘RET’ instruction
at 32773.</p>
<p>After the <code class="docutils literal notranslate"><span class="pre">#EVAL</span></code> macros have been expanded, the second mid-block comment
here is rendered as ‘At this point HL=13699’, and the third is rendered as ‘And
now HL=14371’.</p>
<p>Note that, by default, the simulator does not simulate memory contention or
I/O contention. This means that <code class="docutils literal notranslate"><span class="pre">sim[tstates]</span></code> may not be accurate if the
code being simulated runs in or accesses contended memory, or performs I/O
operations. To simulate memory and I/O contention, set the <code class="docutils literal notranslate"><span class="pre">cmio</span></code> parameter
to 1.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">stop</span></code> parameter is not given, no code is executed, but the
simulator’s registers and hardware state may be updated by providing other
parameters. This technique can be used to initialise the simulator for use by
the <a class="reference internal" href="#audio"><span class="std std-ref">#AUDIO</span></a> or <a class="reference internal" href="#tstates"><span class="std std-ref">#TSTATES</span></a> macro.</p>
<p>Before executing code, the <code class="docutils literal notranslate"><span class="pre">#SIM</span></code> macro copies the simulator state as it was
left by the most recent invocation of either the <a class="reference internal" href="#audio"><span class="std std-ref">#AUDIO</span></a> or the <code class="docutils literal notranslate"><span class="pre">#SIM</span></code>
macro (if any).</p>
<p>Note that code executed by the <code class="docutils literal notranslate"><span class="pre">#SIM</span></code> macro operates directly on the internal
memory snapshot, and therefore can modify it. To avoid that, use the
<a class="reference internal" href="#pushs"><span class="std std-ref">#PUSHS</span></a> and <a class="reference internal" href="#pops"><span class="std std-ref">#POPS</span></a> macros to operate on a copy of the snapshot.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>9.1</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">cmio</span></code>, <code class="docutils literal notranslate"><span class="pre">execint</span></code>, <code class="docutils literal notranslate"><span class="pre">iff</span></code>, <code class="docutils literal notranslate"><span class="pre">im</span></code> and <code class="docutils literal notranslate"><span class="pre">tstates</span></code>
parameters; added support for executing code in a 128K memory
snapshot; added the <code class="docutils literal notranslate"><span class="pre">7ffd</span></code>, <code class="docutils literal notranslate"><span class="pre">ay</span></code>, <code class="docutils literal notranslate"><span class="pre">fffd</span></code>, <code class="docutils literal notranslate"><span class="pre">halted</span></code>,
<code class="docutils literal notranslate"><span class="pre">iff</span></code> and <code class="docutils literal notranslate"><span class="pre">im</span></code> fields to the <code class="docutils literal notranslate"><span class="pre">sim</span></code> dictionary; made the
<code class="docutils literal notranslate"><span class="pre">stop</span></code> parameter optional</p></td>
</tr>
<tr class="row-odd"><td><p>8.7</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="space">
<span id="id28"></span><h3>#SPACE<a class="headerlink" href="#space" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#SPACE</span></code> macro expands to one or more <code class="docutils literal notranslate"><span class="pre">&amp;#160;</span></code> expressions (in HTML
mode) or spaces (in ASM mode).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SPACE[num]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">num</span></code> is the number of spaces required (default: 1), which may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a></p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; &#39;#SPACE8&#39; (8 spaces)
t56832 DEFM &quot;        &quot;
</pre></div>
</div>
<p>In HTML mode, this instance of the <code class="docutils literal notranslate"><span class="pre">#SPACE</span></code> macro expands to:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;
</pre></div>
</div>
<p>In ASM mode, this instance of the <code class="docutils literal notranslate"><span class="pre">#SPACE</span></code> macro expands to a string
containing 8 spaces.</p>
<p>The form <code class="docutils literal notranslate"><span class="pre">SPACE([num])</span></code> may be used to distinguish the macro from adjacent
text where necessary. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; &#39;Score:#SPACE(5)0&#39;
t49152 DEFM &quot;Score:     0&quot;
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the <code class="docutils literal notranslate"><span class="pre">num</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>Added support for arithmetic expressions and skool macros in the
<code class="docutils literal notranslate"><span class="pre">num</span></code> parameter</p></td>
</tr>
<tr class="row-even"><td><p>2.4.1</p></td>
<td><p>Added support for the <code class="docutils literal notranslate"><span class="pre">#SPACE([num])</span></code> syntax</p></td>
</tr>
</tbody>
</table>
</section>
<section id="table">
<span id="id29"></span><h3>#TABLE<a class="headerlink" href="#table" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#TABLE</span></code> macro marks the beginning of a table; <code class="docutils literal notranslate"><span class="pre">TABLE#</span></code> is used to mark
the end. Between these markers, the rows of the table are defined.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#TABLE[([class[,class1[:w][,class2[:w]...]]])][&lt;flag&gt;][rows]TABLE#
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">class</span></code> is the CSS class to use for the <code class="docutils literal notranslate"><span class="pre">&lt;table&gt;</span></code> element</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">class1</span></code>, <code class="docutils literal notranslate"><span class="pre">class2</span></code> etc. are the CSS classes to use for the <code class="docutils literal notranslate"><span class="pre">&lt;td&gt;</span></code>
elements in columns 1, 2 etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flag</span></code> is the wrap flag (see below)</p></li>
</ul>
<p>Each row in a table must start with <code class="docutils literal notranslate"><span class="pre">{</span></code> followed by a space, and end with
<code class="docutils literal notranslate"><span class="pre">}</span></code> preceded by a space. The cells in a row must be separated by <code class="docutils literal notranslate"><span class="pre">|</span></code> with a
space on each side.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #TABLE(default,centre)
; { 0 | Off }
; { 1 | On }
; TABLE#
</pre></div>
</div>
<p>This table has two rows and two columns, and will have the CSS class ‘default’.
The cells in the first column will have the CSS class ‘centre’.</p>
<p>By default, cells will be rendered as <code class="docutils literal notranslate"><span class="pre">&lt;td&gt;</span></code> elements. To render a cell as a
<code class="docutils literal notranslate"><span class="pre">&lt;th&gt;</span></code> element, use the <code class="docutils literal notranslate"><span class="pre">=h</span></code> indicator before the cell contents:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #TABLE
; { =h Header 1  | =h Header 2 }
; { Regular cell | Another one }
; TABLE#
</pre></div>
</div>
<p>It is also possible to specify <code class="docutils literal notranslate"><span class="pre">colspan</span></code> and <code class="docutils literal notranslate"><span class="pre">rowspan</span></code> attributes using the
<code class="docutils literal notranslate"><span class="pre">=c</span></code> and <code class="docutils literal notranslate"><span class="pre">=r</span></code> indicators:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #TABLE
; { =r2 2 rows  | X | Y }
; { =c2           2 columns }
; TABLE#
</pre></div>
</div>
<p>Finally, the <code class="docutils literal notranslate"><span class="pre">=t</span></code> indicator makes a cell transparent (i.e. gives it the same
background colour as the page body).</p>
<p>If a cell requires more than one indicator, separate the indicators by commas:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #TABLE
; { =h,c2 Wide header }
; { Column 1 | Column 2 }
; TABLE#
</pre></div>
</div>
<p>The CSS files included in SkoolKit provide two classes that may be used when
defining tables:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code> - a class for <code class="docutils literal notranslate"><span class="pre">&lt;table&gt;</span></code> elements that provides a background
colour to make the table stand out from the page body</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">centre</span></code> - a class for <code class="docutils literal notranslate"><span class="pre">&lt;td&gt;</span></code> elements that centres their contents</p></li>
</ul>
<p>In ASM mode, tables are rendered as plain text, using dashes (<code class="docutils literal notranslate"><span class="pre">-</span></code>) and pipes
(<code class="docutils literal notranslate"><span class="pre">|</span></code>) for the borders, and plus signs (<code class="docutils literal notranslate"><span class="pre">+</span></code>) where a horizontal border meets
a vertical border.</p>
<p>ASM mode also supports the <code class="docutils literal notranslate"><span class="pre">:w</span></code> indicator in the <code class="docutils literal notranslate"><span class="pre">#TABLE</span></code> macro’s
parameters. The <code class="docutils literal notranslate"><span class="pre">:w</span></code> indicator marks a column as a candidate for having its
width reduced (by wrapping the text it contains) so that the table will be no
more than 79 characters wide when rendered. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #TABLE(default,centre,:w)
; { =h X | =h Description }
; { 0    | Text in this column will be wrapped in ASM mode to make the table less than 80 characters wide }
; TABLE#
</pre></div>
</div>
<p>The wrap flag (<code class="docutils literal notranslate"><span class="pre">flag</span></code>), if present, determines how <a class="reference internal" href="commands.html#sna2skool-py"><span class="std std-ref">sna2skool.py</span></a> will
write table rows when reading from a control file. Supported values are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">nowrap</span></code> - write each table row on a single line</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wrapalign</span></code> - wrap each table row with an indent at the start of the second
and subsequent lines to maintain text alignment with the rightmost column on
the first line</p></li>
</ul>
<p>By default, each table row is wrapped over multiple lines with no indent.</p>
<p>See also <a class="reference internal" href="#udgtable"><span class="std std-ref">#UDGTABLE</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>7.2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">#TABLE</span></code> can be used in register descriptions in ASM mode</p></td>
</tr>
<tr class="row-odd"><td><p>7.0</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">nowrap</span></code> and <code class="docutils literal notranslate"><span class="pre">wrapalign</span></code> flags</p></td>
</tr>
<tr class="row-even"><td><p>6.4</p></td>
<td><p>In ASM mode, <code class="docutils literal notranslate"><span class="pre">#TABLE</span></code> can be used in an instruction-level
comment and as a parameter of another macro</p></td>
</tr>
</tbody>
</table>
</section>
<section id="tstates">
<span id="id30"></span><h3>#TSTATES<a class="headerlink" href="#tstates" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#TSTATES</span></code> macro expands to the time taken, in T-states, to execute one
or more instructions.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#TSTATESstart[,stop,flags,execint,cmio(text)]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">start</span></code> is the address of the instruction at which to start the clock</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stop</span></code> is the address of the instruction at which to stop the clock</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flags</span></code> controls various options (see below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">text</span></code> is the text to expand to (when bit 1 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> is set); this may
contain the placeholders <code class="docutils literal notranslate"><span class="pre">$min</span></code> and <code class="docutils literal notranslate"><span class="pre">$max</span></code> for the sums of the smaller
and larger timing values of the instructions in the given range, or
<code class="docutils literal notranslate"><span class="pre">$tstates</span></code> for the actual timing value when bit 2 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> is set</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">execint</span></code> specifies whether to execute interrupt routines (1), or ignore
interrupts (0, the default) when simulating code execution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmio</span></code> specifies whether memory and I/O contention are simulated (1), or
not simulated (0, the default)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">flags</span></code> is the sum of the following values, chosen according to the desired
outcome:</p>
<ul class="simple">
<li><p>1 (bit 0) - use the larger timing value for an instruction whose timing is
variable</p></li>
<li><p>2 (bit 1) - expand to <code class="docutils literal notranslate"><span class="pre">text</span></code></p></li>
<li><p>4 (bit 2) - execute instructions in a simulator to get the actual timing</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>c30000 LD A,1   ; This instruction takes #TSTATES30000 T-states
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#TSTATES</span></code> macros expands to ‘7’.</p>
<p>For any instruction in the range <code class="docutils literal notranslate"><span class="pre">start</span></code> to <code class="docutils literal notranslate"><span class="pre">stop</span></code> whose timing is variable
(e.g. a conditional call, return or relative jump), the smaller timing value is
used by default:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>c40000 RET Z    ; This instruction takes at least #TSTATES40000 T-states
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#TSTATES</span></code> macros expands to ‘5’.</p>
<p>To use the larger timing values, set bit 0 of <code class="docutils literal notranslate"><span class="pre">flags</span></code>. If both smaller and
larger timing values are required, set bit 1 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> and use the <code class="docutils literal notranslate"><span class="pre">text</span></code>
parameter:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>c50000 LD B,100    ; Set the delay parameter
 50002 DJNZ 50002  ; Delay for #TSTATES50002,,2(#EVAL(99*$max+$min)) T-states
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#TSTATES</span></code> macro expands to <code class="docutils literal notranslate"><span class="pre">#EVAL(99*13+8)</span></code>, which in
turn expands to ‘1295’.</p>
<p>Note that unless bit 2 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> is set, only true assembly language
instructions (i.e. not <code class="docutils literal notranslate"><span class="pre">DEFB</span></code>, <code class="docutils literal notranslate"><span class="pre">DEFM</span></code>, <code class="docutils literal notranslate"><span class="pre">DEFS</span></code> and <code class="docutils literal notranslate"><span class="pre">DEFW</span></code> statements)
can be timed.</p>
<p>If bit 2 of <code class="docutils literal notranslate"><span class="pre">flags</span></code> is set, the <code class="docutils literal notranslate"><span class="pre">stop</span></code> address must be specified, and the
instructions are executed in a simulator to determine their actual timing. This
is useful for computing the time taken by conditional operations and operations
that are repeated in a loop. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>c32768 LD DE,0     ; {This creates a delay of #TSTATES(32768,32776,4)
*32771 DEC DE      ; T-states
 32772 LD A,D      ;
 32773 OR E        ;
 32774 JR NZ,32771 ; }
 32776 RET
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#TSTATES</span></code> macro expands to ‘1703941’.</p>
<p>Note that, by default, the simulator does not simulate memory contention or
I/O contention. This means that the time reported by <code class="docutils literal notranslate"><span class="pre">#TSTATES</span></code> may not be
accurate if the code being simulated runs in or accesses contended memory, or
performs I/O operations. To obtain precise timing in such cases, set the
<code class="docutils literal notranslate"><span class="pre">cmio</span></code> parameter to 1.</p>
<p>Before executing code in a simulator, the <code class="docutils literal notranslate"><span class="pre">#TSTATES</span></code> macro copies the
simulator state as it was left by the most recent invocation of the
<a class="reference internal" href="#audio"><span class="std std-ref">#AUDIO</span></a> or <a class="reference internal" href="#sim"><span class="std std-ref">#SIM</span></a> macro (if any).</p>
<p>However, unlike the <a class="reference internal" href="#audio"><span class="std std-ref">#AUDIO</span></a> and <a class="reference internal" href="#sim"><span class="std std-ref">#SIM</span></a> macros, code executed by the
<code class="docutils literal notranslate"><span class="pre">#TSTATES</span></code> macro operates on a copy of the internal memory snapshot, and
therefore does not modify it.</p>
<p>The integer parameters of the <code class="docutils literal notranslate"><span class="pre">#TSTATES</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">text</span></code> parameter.</p>
<p>See also the <a class="reference internal" href="#sim"><span class="std std-ref">#SIM</span></a> macro, which can not only time instructions, but also
track changes to register values as code is executed.</p>
<p>See also the <code class="docutils literal notranslate"><span class="pre">Timings</span></code> configuration parameter for
<a class="reference internal" href="commands.html#sna2skool-conf"><span class="std std-ref">sna2skool.py</span></a>, which can be used to show instruction
timings in comment fields when disassembling a snapshot.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>9.1</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">cmio</span></code> and <code class="docutils literal notranslate"><span class="pre">execint</span></code> parameters; added support for
executing code in a 128K memory snapshot</p></td>
</tr>
<tr class="row-odd"><td><p>8.7</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="udgtable">
<span id="id31"></span><h3>#UDGTABLE<a class="headerlink" href="#udgtable" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#UDGTABLE</span></code> macro behaves in exactly the same way as the <code class="docutils literal notranslate"><span class="pre">#TABLE</span></code>
macro, except that the resulting table will not be rendered in ASM mode. Its
intended use is to contain images that will be rendered in HTML mode only.</p>
<p>See <a class="reference internal" href="#table"><span class="std std-ref">#TABLE</span></a>, and also <a class="reference internal" href="#html"><span class="std std-ref">#HTML</span></a>.</p>
</section>
<section id="version">
<span id="id32"></span><h3>#VERSION<a class="headerlink" href="#version" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#VERSION</span></code> macro expands to the version of SkoolKit.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#VERSION
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>6.0</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="image-macros">
<span id="imagemacros"></span><h2>Image macros<a class="headerlink" href="#image-macros" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="#copy"><span class="std std-ref">#COPY</span></a>, <a class="reference internal" href="#font"><span class="std std-ref">#FONT</span></a>, <a class="reference internal" href="#over"><span class="std std-ref">#OVER</span></a>, <a class="reference internal" href="#plot"><span class="std std-ref">#PLOT</span></a>, <a class="reference internal" href="#scr"><span class="std std-ref">#SCR</span></a>, <a class="reference internal" href="#udg"><span class="std std-ref">#UDG</span></a>,
<a class="reference internal" href="#udgarray"><span class="std std-ref">#UDGARRAY</span></a> and <a class="reference internal" href="#udgs"><span class="std std-ref">#UDGS</span></a> macros (described in the following sections)
may be used to create images based on graphic data in the memory snapshot. They
are not supported in ASM mode.</p>
<p>Some of these macros have several numeric parameters, most of which are
optional. This can give rise to a long sequence of commas in a macro parameter
string, making it hard to read (and write); for example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG32768,,,,,,1
</pre></div>
</div>
<p>To alleviate this problem, the image macros accept keyword arguments at any
position in the parameter string; the <code class="docutils literal notranslate"><span class="pre">#UDG</span></code> macro above could be rewritten
as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG32768,rotate=1
</pre></div>
</div>
<section id="copy">
<span id="id33"></span><h3>#COPY<a class="headerlink" href="#copy" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#COPY</span></code> macro copies all or part of an existing frame into
a new frame.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#COPY[x,y,width,height,scale,mask,tindex,alpha][{CROP}](old,new)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are the coordinates of the top left tile of the existing
frame to include in the new frame (default: (0, 0))</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">width</span></code> and <code class="docutils literal notranslate"><span class="pre">height</span></code> are the width and height (in tiles) of the portion
of the existing frame to copy (by default, the portion extends to the right
and bottom edges of the existing frame)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale</span></code> is the scale of the new frame; if omitted, the scale of the
existing frame is used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code> is the mask type of the new frame (see <a class="reference internal" href="#masks"><span class="std std-ref">Masks</span></a>); if omitted,
the mask type of the existing frame is used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tindex</span></code> is the index (0-15) of the entry in the palette to use as the
transparent colour for the new frame (see <a class="reference internal" href="#palette"><span class="std std-ref">Palette</span></a>); if omitted, the
transparency index of the existing frame is used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code> is the alpha value (0-255) to use for the transparent colour in the
new frame; if omitted, the alpha value of the existing frame is used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CROP</span></code> is the cropping specification for the new frame (see
<a class="reference internal" href="#cropping"><span class="std std-ref">Cropping</span></a>); if omitted, the cropping specification of the existing
frame is used</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">old</span></code> is the name of the existing frame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">new</span></code> is the name of the new frame</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #UDGARRAY4(30000-30120-8)(*original)
; #COPY1,1,2,2(original,centre)
; #UDGARRAY*centre(img)
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#COPY</span></code> macro creates a new frame from a copy of the
central 2x2 portion of the 4x4 frame created by the <code class="docutils literal notranslate"><span class="pre">#UDGARRAY</span></code> macro.  The
<code class="docutils literal notranslate"><span class="pre">#UDGARRAY*</span></code> macro then creates an image of the new frame.</p>
<p>The integer parameters and the cropping specification of the <code class="docutils literal notranslate"><span class="pre">#COPY</span></code> macro
may contain <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">old</span></code> and <code class="docutils literal notranslate"><span class="pre">new</span></code> parameters.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.6</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">tindex</span></code> and <code class="docutils literal notranslate"><span class="pre">alpha</span></code> parameters</p></td>
</tr>
<tr class="row-odd"><td><p>8.5</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="font">
<span id="id34"></span><h3>#FONT<a class="headerlink" href="#font" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#FONT</span></code> macro expands to an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element for an image
of text rendered in the game font.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#FONT[:(text)]addr[,chars,attr,scale,tindex,alpha][{CROP}][(fname)]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">text</span></code> is the text to render (default: the 96 characters from code 32 to
code 127)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span></code> is the base address of the font graphic data</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">chars</span></code> is the number of characters to render (default: the length of
<code class="docutils literal notranslate"><span class="pre">text</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attr</span></code> is the attribute byte to use (default: 56)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale</span></code> is the scale of the image (default: 2)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tindex</span></code> is the index (0-15) of the entry in the palette to use as the
transparent colour (default: 0; see <a class="reference internal" href="#palette"><span class="std std-ref">Palette</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code> is the alpha value (0-255) to use for the transparent colour
(default: the value of the <code class="docutils literal notranslate"><span class="pre">PNGAlpha</span></code> parameter in the
<a class="reference internal" href="ref-files.html#ref-imagewriter"><span class="std std-ref">[ImageWriter]</span></a> section)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CROP</span></code> is the cropping specification (see <a class="reference internal" href="#cropping"><span class="std std-ref">Cropping</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fname</span></code> is the name of the image file (see <a class="reference internal" href="#filenames"><span class="std std-ref">Filenames</span></a>; default:
‘<cite>font</cite>’)</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; Font graphic data
;
; #HTML[#FONT:(0123456789)49152]
</pre></div>
</div>
<p>In HTML mode, this instance of the <code class="docutils literal notranslate"><span class="pre">#FONT</span></code> macro expands to an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>
element for the image of the digits 0-9 in the 8x8 font whose graphic data
starts at 49152.</p>
<p>The integer parameters and the cropping specification of the <code class="docutils literal notranslate"><span class="pre">#FONT</span></code> macro
may contain <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">text</span></code> parameter.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the integer parameters
and the cropping specification</p></td>
</tr>
<tr class="row-odd"><td><p>8.2</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">tindex</span></code> and <code class="docutils literal notranslate"><span class="pre">alpha</span></code> parameters</p></td>
</tr>
<tr class="row-even"><td><p>6.3</p></td>
<td><p>Added support for image path ID replacement fields in the
<code class="docutils literal notranslate"><span class="pre">fname</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>Added support for arithmetic expressions and skool macros in the
numeric parameters</p></td>
</tr>
<tr class="row-even"><td><p>4.3</p></td>
<td><p>Added the ability to create frames</p></td>
</tr>
<tr class="row-odd"><td><p>4.2</p></td>
<td><p>Added the ability to specify alt text for the <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element</p></td>
</tr>
<tr class="row-even"><td><p>4.0</p></td>
<td><p>Added support for keyword arguments</p></td>
</tr>
<tr class="row-odd"><td><p>3.6</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">text</span></code> parameter, and made the <code class="docutils literal notranslate"><span class="pre">chars</span></code> parameter
optional</p></td>
</tr>
<tr class="row-even"><td><p>3.0</p></td>
<td><p>Added image-cropping capabilities</p></td>
</tr>
<tr class="row-odd"><td><p>2.0.5</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">fname</span></code> parameter and support for regular 8x8 fonts</p></td>
</tr>
</tbody>
</table>
</section>
<section id="over">
<span id="id35"></span><h3>#OVER<a class="headerlink" href="#over" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#OVER</span></code> macro superimposes one frame (the foreground frame)
on another (the background frame).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#OVERx,y[,xoffset,yoffset,rmode][(attr)][(byte)](bg,fg)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are the tile coordinates on the background frame at which to
superimpose the foreground frame; negative coordinates are allowed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">xoffset</span></code> and <code class="docutils literal notranslate"><span class="pre">yoffset</span></code> are the pixel offsets by which to shift the
foreground frame from the given tile coordinates (default: (0, 0))</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rmode</span></code> is the attribute and graphic byte replacement mode (see below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attr</span></code> is the replacement attribute byte for any background UDG over which
a foreground UDG is superimposed (when <code class="docutils literal notranslate"><span class="pre">rmode</span></code> is 1 or 3)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">byte</span></code> is the replacement graphic byte for any background UDG over which
a foreground UDG is superimposed (when <code class="docutils literal notranslate"><span class="pre">rmode</span></code> is 2 or 3)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bg</span></code> is the name of the background frame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fg</span></code> is the name of the foreground frame</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">rmode</span></code> specifies whether and how to replace the attribute and graphic bytes
of each background UDG over which a foreground UDG is superimposed:</p>
<ul class="simple">
<li><p>0 - leave the attribute byte unchanged and apply the foreground frame’s mask</p></li>
<li><p>1 - replace the attribute byte with the value of <code class="docutils literal notranslate"><span class="pre">attr</span></code> and apply the
foreground frame’s mask</p></li>
<li><p>2 - leave the attribute byte unchanged and replace the graphic bytes with the
value of <code class="docutils literal notranslate"><span class="pre">byte</span></code></p></li>
<li><p>3 - replace the attribute byte with the value of <code class="docutils literal notranslate"><span class="pre">attr</span></code> and replace the
graphic bytes with the value of <code class="docutils literal notranslate"><span class="pre">byte</span></code></p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">attr</span></code> is an expression that is evaluated once for each background UDG over
which a foreground UDG is superimposed. <code class="docutils literal notranslate"><span class="pre">attr</span></code> may contain skool macros, and
recognises the following placeholders:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$b</span></code> - the background UDG attribute value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$f</span></code> - the foreground UDG attribute value</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">byte</span></code> is an expression that is evaluated once for each of the 8 graphic
bytes in a background UDG over which a foreground UDG is superimposed. <code class="docutils literal notranslate"><span class="pre">byte</span></code>
may contain skool macros, and recognises the following placeholders:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">$b</span></code> - the background UDG graphic byte value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$f</span></code> - the foreground UDG graphic byte value</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">$m</span></code> - the foreground UDG mask byte value (or 0 if the foreground UDG has
no mask)</p></li>
</ul>
<p>If the foreground frame has no mask, its contents are combined with those of
the background frame by OR operations.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #UDGARRAY2(30000-30024-8)(*background)
; #UDG30032:30040(*object)
; #OVER0,1(background,object)
; #UDGARRAY*background(image)
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#OVER</span></code> macro superimposes the frame created by the
<code class="docutils literal notranslate"><span class="pre">#UDG</span></code> macro at tile coordinates (0, 1) on the background frame created by
the <code class="docutils literal notranslate"><span class="pre">#UDGARRAY</span></code> macro. The <code class="docutils literal notranslate"><span class="pre">#UDGARRAY*</span></code> macro then creates an image of the
modified background frame.</p>
<p>The integer parameters of the <code class="docutils literal notranslate"><span class="pre">#OVER</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">bg</span></code> and <code class="docutils literal notranslate"><span class="pre">fg</span></code> parameters.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.5</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="plot">
<span id="id36"></span><h3>#PLOT<a class="headerlink" href="#plot" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#PLOT</span></code> macro sets, resets or flips a pixel in a frame
already created by one of the other image macros.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#PLOTx,y[,value](frame)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are the coordinates of the pixel, relative to the top-left
corner of the frame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">value</span></code> is 0 to reset the pixel, 1 to set it (the default), or 2 to flip it</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frame</span></code> is the name of the frame</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #UDG30000(*tile)
; #PLOT1,2(tile)
; #UDGARRAY*tile(tile)
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#PLOT</span></code> macro sets the second pixel from the left in the
third row from the top in the frame created by the <code class="docutils literal notranslate"><span class="pre">#UDG</span></code> macro. The
<code class="docutils literal notranslate"><span class="pre">#UDGARRAY*</span></code> macro then creates an image of the modified frame.</p>
<p>The integer parameters of the <code class="docutils literal notranslate"><span class="pre">#PLOT</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.3</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="scr">
<span id="id37"></span><h3>#SCR<a class="headerlink" href="#scr" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#SCR</span></code> macro expands to an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element for an image
constructed from the display file and attribute file (or suitably arranged
graphic data and attribute bytes elsewhere in memory) of the current memory
snapshot (in turn constructed from the contents of the skool file).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SCR[scale,x,y,w,h,df,af,tindex,alpha][{CROP}][(fname)]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">scale</span></code> is the scale of the image (default: 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> is the x-coordinate of the top-left tile of the screen to include in
the screenshot (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y</span></code> is the y-coordinate of the top-left tile of the screen to include in
the screenshot (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">w</span></code> is the width of the screenshot in tiles (default: 32)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">h</span></code> is the height of the screenshot in tiles (default: 24)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">df</span></code> is the base address of the display file (default: 16384)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">af</span></code> is the base address of the attribute file (default: 22528)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tindex</span></code> is the index (0-15) of the entry in the palette to use as the
transparent colour (default: 0; see <a class="reference internal" href="#palette"><span class="std std-ref">Palette</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code> is the alpha value (0-255) to use for the transparent colour
(default: the value of the <code class="docutils literal notranslate"><span class="pre">PNGAlpha</span></code> parameter in the
<a class="reference internal" href="ref-files.html#ref-imagewriter"><span class="std std-ref">[ImageWriter]</span></a> section)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CROP</span></code> is the cropping specification (see <a class="reference internal" href="#cropping"><span class="std std-ref">Cropping</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fname</span></code> is the name of the image file (see <a class="reference internal" href="#filenames"><span class="std std-ref">Filenames</span></a>; default:
‘<cite>scr</cite>’)</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #UDGTABLE
; { #SCR(loading) | This is the loading screen. }
; TABLE#
</pre></div>
</div>
<p>The integer parameters and the cropping specification of the <code class="docutils literal notranslate"><span class="pre">#SCR</span></code> macro
may contain <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the integer parameters
and the cropping specification</p></td>
</tr>
<tr class="row-odd"><td><p>8.2</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">tindex</span></code> and <code class="docutils literal notranslate"><span class="pre">alpha</span></code> parameters</p></td>
</tr>
<tr class="row-even"><td><p>6.3</p></td>
<td><p>Added support for image path ID replacement fields in the
<code class="docutils literal notranslate"><span class="pre">fname</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>Added support for arithmetic expressions and skool macros in the
numeric parameters</p></td>
</tr>
<tr class="row-even"><td><p>4.3</p></td>
<td><p>Added the ability to create frames</p></td>
</tr>
<tr class="row-odd"><td><p>4.2</p></td>
<td><p>Added the ability to specify alt text for the <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element</p></td>
</tr>
<tr class="row-even"><td><p>4.0</p></td>
<td><p>Added support for keyword arguments</p></td>
</tr>
<tr class="row-odd"><td><p>3.0</p></td>
<td><p>Added image-cropping capabilities and the <code class="docutils literal notranslate"><span class="pre">df</span></code> and <code class="docutils literal notranslate"><span class="pre">af</span></code>
parameters</p></td>
</tr>
<tr class="row-even"><td><p>2.0.5</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">scale</span></code>, <code class="docutils literal notranslate"><span class="pre">x</span></code>, <code class="docutils literal notranslate"><span class="pre">y</span></code>, <code class="docutils literal notranslate"><span class="pre">w</span></code>, <code class="docutils literal notranslate"><span class="pre">h</span></code> and <code class="docutils literal notranslate"><span class="pre">fname</span></code>
parameters</p></td>
</tr>
</tbody>
</table>
</section>
<section id="udg">
<span id="id38"></span><h3>#UDG<a class="headerlink" href="#udg" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#UDG</span></code> macro expands to an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element for the image
of a UDG (an 8x8 block of pixels).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDGaddr[,attr,scale,step,inc,flip,rotate,mask,tindex,alpha][:MASK][{CROP}][(fname)]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span></code> is the base address of the UDG bytes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attr</span></code> is the attribute byte to use (default: 56)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale</span></code> is the scale of the image (default: 4)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is the interval between successive bytes of the UDG (default: 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inc</span></code> is added to each UDG byte before constructing the image (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flip</span></code> is 1 to flip the UDG horizontally, 2 to flip it vertically, 3 to
flip it both ways, or 0 to leave it as it is (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rotate</span></code> is 1 to rotate the UDG 90 degrees clockwise, 2 to rotate it 180
degrees, 3 to rotate it 90 degrees anticlockwise, or 0 to leave it as it is
(default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code> is the type of mask to apply (see <a class="reference internal" href="#masks"><span class="std std-ref">Masks</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tindex</span></code> is the index (0-15) of the entry in the palette to use as the
transparent colour (default: 0; see <a class="reference internal" href="#palette"><span class="std std-ref">Palette</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code> is the alpha value (0-255) to use for the transparent colour
(default: the value of the <code class="docutils literal notranslate"><span class="pre">PNGAlpha</span></code> parameter in the
<a class="reference internal" href="ref-files.html#ref-imagewriter"><span class="std std-ref">[ImageWriter]</span></a> section)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MASK</span></code> is the mask specification (see below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CROP</span></code> is the cropping specification (see <a class="reference internal" href="#cropping"><span class="std std-ref">Cropping</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fname</span></code> is the name of the image file (see <a class="reference internal" href="#filenames"><span class="std std-ref">Filenames</span></a>); if not given,
a name specified by the <code class="docutils literal notranslate"><span class="pre">UDGFilename</span></code> parameter in the <a class="reference internal" href="ref-files.html#paths"><span class="std std-ref">[Paths]</span></a> section
will be used</p></li>
</ul>
<p>The mask specification (<code class="docutils literal notranslate"><span class="pre">MASK</span></code>) takes the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>addr[,step]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span></code> is the base address of the mask bytes to use for the UDG</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is the interval between successive mask bytes (defaults to the value
of <code class="docutils literal notranslate"><span class="pre">step</span></code> for the UDG)</p></li>
</ul>
<p>Note that if any of the parameters in the mask specification is expressed using
arithmetic operations or skool macros, then the entire specification must be
enclosed in parentheses.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; Safe key UDG
;
; #HTML[#UDG39144,6(safe_key)]
</pre></div>
</div>
<p>In HTML mode, this instance of the <code class="docutils literal notranslate"><span class="pre">#UDG</span></code> macro expands to an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>
element for the image of the UDG at 39144 (which will be named <cite>safe_key.png</cite>),
with attribute byte 6 (INK 6: PAPER 0).</p>
<p>The integer parameters, mask specification and cropping specification of the
<code class="docutils literal notranslate"><span class="pre">#UDG</span></code> macro may contain <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the integer parameters,
mask specification and cropping specification</p></td>
</tr>
<tr class="row-odd"><td><p>8.2</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">tindex</span></code> and <code class="docutils literal notranslate"><span class="pre">alpha</span></code> parameters</p></td>
</tr>
<tr class="row-even"><td><p>6.3</p></td>
<td><p>Added support for image path ID replacement fields in the
<code class="docutils literal notranslate"><span class="pre">fname</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>Added support for arithmetic expressions and skool macros in the
numeric parameters</p></td>
</tr>
<tr class="row-even"><td><p>4.3</p></td>
<td><p>Added the ability to create frames</p></td>
</tr>
<tr class="row-odd"><td><p>4.2</p></td>
<td><p>Added the ability to specify alt text for the <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element</p></td>
</tr>
<tr class="row-even"><td><p>4.0</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">mask</span></code> parameter and support for AND-OR masking;
added support for keyword arguments</p></td>
</tr>
<tr class="row-odd"><td><p>3.1.2</p></td>
<td><p>Made the <code class="docutils literal notranslate"><span class="pre">attr</span></code> parameter optional</p></td>
</tr>
<tr class="row-even"><td><p>3.0</p></td>
<td><p>Added image-cropping capabilities</p></td>
</tr>
<tr class="row-odd"><td><p>2.4</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">rotate</span></code> parameter</p></td>
</tr>
<tr class="row-even"><td><p>2.3.1</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">flip</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>2.1</p></td>
<td><p>Added support for masks</p></td>
</tr>
<tr class="row-even"><td><p>2.0.5</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">fname</span></code> parameter</p></td>
</tr>
</tbody>
</table>
</section>
<section id="udgarray">
<span id="id39"></span><h3>#UDGARRAY<a class="headerlink" href="#udgarray" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#UDGARRAY</span></code> macro expands to an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element for the
image of an array of UDGs (8x8 blocks of pixels).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDGARRAYwidth[,attr,scale,step,inc,flip,rotate,mask,tindex,alpha](SPEC1[;SPEC2;...])[@ATTRS1[;ATTRS2;...]][{CROP}](fname)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">width</span></code> is the width of the image (in UDGs)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attr</span></code> is the default attribute byte of each UDG (default: 56)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale</span></code> is the scale of the image (default: 2)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is the default interval between successive bytes of each UDG
(default: 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inc</span></code> is added to each UDG byte before constructing the image (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flip</span></code> is 1 to flip the array of UDGs horizontally, 2 to flip it
vertically, 3 to flip it both ways, or 0 to leave it as it is (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rotate</span></code> is 1 to rotate the array of UDGs 90 degrees clockwise, 2 to rotate
it 180 degrees, 3 to rotate it 90 degrees anticlockwise, or 0 to leave it as
it is (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code> is the type of mask to apply (see <a class="reference internal" href="#masks"><span class="std std-ref">Masks</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tindex</span></code> is the index (0-15) of the entry in the palette to use as the
transparent colour (default: 0; see <a class="reference internal" href="#palette"><span class="std std-ref">Palette</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code> is the alpha value (0-255) to use for the transparent colour
(default: the value of the <code class="docutils literal notranslate"><span class="pre">PNGAlpha</span></code> parameter in the
<a class="reference internal" href="ref-files.html#ref-imagewriter"><span class="std std-ref">[ImageWriter]</span></a> section)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CROP</span></code> is the cropping specification (see <a class="reference internal" href="#cropping"><span class="std std-ref">Cropping</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fname</span></code> is the name of the image file (see <a class="reference internal" href="#filenames"><span class="std std-ref">Filenames</span></a>)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">SPEC1</span></code>, <code class="docutils literal notranslate"><span class="pre">SPEC2</span></code> etc. are UDG specifications for the sets of UDGs that make
up the array. The parentheses around them are optional, but recommended. If the
parentheses are omitted, <code class="docutils literal notranslate"><span class="pre">SPEC1</span></code> must be prefixed by a semicolon to separate
it from the main parameters. Each UDG specification has the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>addr[,attr,step,inc][:MASK]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span></code> is the address range specification for the set of UDGs (see below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">attr</span></code> is the attribute byte of each UDG in the set (defaults to the value
of <code class="docutils literal notranslate"><span class="pre">attr</span></code> for the UDG array)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is the interval between successive bytes of each UDG in the set
(defaults to the value of <code class="docutils literal notranslate"><span class="pre">step</span></code> for the UDG array)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inc</span></code> is added to each byte of every UDG in the set before constructing the
image (defaults to the value of <code class="docutils literal notranslate"><span class="pre">inc</span></code> for the UDG array)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MASK</span></code> is the mask specification</p></li>
</ul>
<p>The mask specification (<code class="docutils literal notranslate"><span class="pre">MASK</span></code>) takes the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>addr[,step]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span></code> is the address range specification for the set of mask UDGs (see
below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is the interval between successive bytes of each mask UDG in the set
(defaults to the value of <code class="docutils literal notranslate"><span class="pre">step</span></code> for the set of UDGs)</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ATTRS1</span></code>, <code class="docutils literal notranslate"><span class="pre">ATTRS2</span></code> etc. are attribute address range specifications (see
below). If supplied, attribute values are taken from the specified addresses
instead of the <code class="docutils literal notranslate"><span class="pre">attr</span></code> parameter values.</p>
<p>Address range specifications (for both UDGs and attributes) may be given in one
of the following forms:</p>
<ul class="simple">
<li><p>a single address (e.g. <code class="docutils literal notranslate"><span class="pre">39144</span></code>)</p></li>
<li><p>a simple address range (e.g. <code class="docutils literal notranslate"><span class="pre">33008-33015</span></code>)</p></li>
<li><p>an address range with a step (e.g. <code class="docutils literal notranslate"><span class="pre">32768-33792-256</span></code>)</p></li>
<li><p>an address range with a horizontal and a vertical step (e.g.
<code class="docutils literal notranslate"><span class="pre">63476-63525-1-16</span></code>; this form specifies the step between the base addresses
of adjacent items in each row as 1, and the step between the base addresses
of adjacent items in each column as 16)</p></li>
</ul>
<p>Any of these forms of address ranges can be repeated by appending <code class="docutils literal notranslate"><span class="pre">xN</span></code>, where
<code class="docutils literal notranslate"><span class="pre">N</span></code> is the desired number of repetitions. For example:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">39648x3</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">39648;39648;39648</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">32768-32769x2</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">32768;32769;32768;32769</span></code></p></li>
</ul>
<p>As many UDG specifications as required may be supplied, separated by
semicolons; the UDGs will be arranged in a rectangular array with the given
width.</p>
<p>Note that, like the main parameters of a <code class="docutils literal notranslate"><span class="pre">#UDGARRAY</span></code> macro (up to but not
including the first semicolon), if any of the following parts of the parameter
string is expressed using arithmetic operations or skool macros, then that part
must be enclosed in parentheses:</p>
<ul class="simple">
<li><p>any of the 1-5 parts of a UDG, mask or attribute address range specification
(separated by <code class="docutils literal notranslate"><span class="pre">-</span></code> and <code class="docutils literal notranslate"><span class="pre">x</span></code>)</p></li>
<li><p>the part of a UDG or mask specification after the comma that follows the
address range</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; Base sprite
;
; #HTML[#UDGARRAY4(32768-32888-8)(base_sprite.png)]
</pre></div>
</div>
<p>In HTML mode, this instance of the <code class="docutils literal notranslate"><span class="pre">#UDGARRAY</span></code> macro expands to an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>
element for the image of the 4x4 sprite formed by the 16 UDGs with base
addresses 32768, 32776, 32784 and so on up to 32888; the image file will be
named <cite>base_sprite.png</cite>.</p>
<p>The integer parameters, UDG specifications, attribute address range
specification and cropping specification of the <code class="docutils literal notranslate"><span class="pre">#UDGARRAY</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See also <a class="reference internal" href="#udgs"><span class="std std-ref">#UDGS</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.6</p></td>
<td><p>The UDG specifications may be enclosed in parentheses</p></td>
</tr>
<tr class="row-odd"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the integer parameters
and the UDG, attribute address range and cropping specifications</p></td>
</tr>
<tr class="row-even"><td><p>8.2</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">tindex</span></code> and <code class="docutils literal notranslate"><span class="pre">alpha</span></code> parameters</p></td>
</tr>
<tr class="row-odd"><td><p>7.1</p></td>
<td><p>Added the ability to specify attribute addresses</p></td>
</tr>
<tr class="row-even"><td><p>6.3</p></td>
<td><p>Added support for image path ID replacement fields in the
<code class="docutils literal notranslate"><span class="pre">fname</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>Added support for arithmetic expressions and skool macros in the
numeric parameters</p></td>
</tr>
<tr class="row-even"><td><p>4.2</p></td>
<td><p>Added the ability to specify alt text for the <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element</p></td>
</tr>
<tr class="row-odd"><td><p>4.0</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">mask</span></code> parameter and support for AND-OR masking;
added support for keyword arguments</p></td>
</tr>
<tr class="row-even"><td><p>3.6</p></td>
<td><p>Added support for creating an animated image from an arbitrary
sequence of frames</p></td>
</tr>
<tr class="row-odd"><td><p>3.1.1</p></td>
<td><p>Added support for UDG address ranges with horizontal and vertical
steps</p></td>
</tr>
<tr class="row-even"><td><p>3.0</p></td>
<td><p>Added image-cropping capabilities</p></td>
</tr>
<tr class="row-odd"><td><p>2.4</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">rotate</span></code> parameter</p></td>
</tr>
<tr class="row-even"><td><p>2.3.1</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">flip</span></code> parameter</p></td>
</tr>
<tr class="row-odd"><td><p>2.2.5</p></td>
<td><p>Added support for masks</p></td>
</tr>
<tr class="row-even"><td><p>2.0.5</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="udgs">
<span id="id40"></span><h3>#UDGS<a class="headerlink" href="#udgs" title="Permalink to this heading">¶</a></h3>
<p>In HTML mode, the <code class="docutils literal notranslate"><span class="pre">#UDGS</span></code> macro expands to an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element for the image
of a rectangular array of UDGs (8x8 blocks of pixels).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDGSwidth,height[,scale,flip,rotate,mask,tindex,alpha][{CROP}](fname)(uframe)
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">width</span></code> is the width of the array</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height</span></code> is the height of the array</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale</span></code> is the scale of the image</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">flip</span></code> is 1 to flip the array of UDGs horizontally, 2 to flip it
vertically, 3 to flip it both ways, or 0 to leave it as it is (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rotate</span></code> is 1 to rotate the array of UDGs 90 degrees clockwise, 2 to rotate
it 180 degrees, 3 to rotate it 90 degrees anticlockwise, or 0 to leave it as
it is (default: 0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask</span></code> is the type of mask to apply (see <a class="reference internal" href="#masks"><span class="std std-ref">Masks</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tindex</span></code> is the index (0-15) of the entry in the palette to use as the
transparent colour (see <a class="reference internal" href="#palette"><span class="std std-ref">Palette</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">alpha</span></code> is the alpha value (0-255) to use for the transparent colour</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CROP</span></code> is the cropping specification (see <a class="reference internal" href="#cropping"><span class="std std-ref">Cropping</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fname</span></code> is the name of the image file (see <a class="reference internal" href="#filenames"><span class="std std-ref">Filenames</span></a>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uframe</span></code> is expanded once for each slot in the array, and may contain the
placeholders <code class="docutils literal notranslate"><span class="pre">$x</span></code> and <code class="docutils literal notranslate"><span class="pre">$y</span></code> for the coordinates of the slot; the resulting
text is interpreted as the name of the frame whose top-left UDG should be
placed into the slot</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDGS2,2(sprite)(
  #LET(a=30000+9*(2*$y+$x))
  #UDG({a}+1,#PEEK({a}))(*udg)
  udg
)
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#UDGS</span></code> macro expands to an <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element for the
image of the 2x2 sprite formed by the four 9-byte UDG definitions (where the
first byte is the attribute value, and the next eight bytes are the graphic
data) with base addresses 30000, 30009, 30018 and 30027. The image file is
named <cite>sprite.png</cite>.</p>
<p>Unless specified by macro arguments, the scale, mask type, transparency index
and alpha value of the image created by the <code class="docutils literal notranslate"><span class="pre">#UDGS</span></code> macro are copied from the
last frame used to populate the array (corresponding to the bottom-right UDG).</p>
<p>The integer parameters and the <code class="docutils literal notranslate"><span class="pre">uframe</span></code> parameter of the <code class="docutils literal notranslate"><span class="pre">#UDGS</span></code> macro may
contain <a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See <a class="reference internal" href="#stringparameters"><span class="std std-ref">String parameters</span></a> for details on alternative ways to supply the
<code class="docutils literal notranslate"><span class="pre">uframe</span></code> parameter.</p>
<p>See also <a class="reference internal" href="#udgarray"><span class="std std-ref">#UDGARRAY</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.6</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="filenames">
<span id="id41"></span><h3>Filenames<a class="headerlink" href="#filenames" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">fname</span></code> parameter of the <a class="reference internal" href="#font"><span class="std std-ref">#FONT</span></a>, <a class="reference internal" href="#scr"><span class="std std-ref">#SCR</span></a>, <a class="reference internal" href="#udg"><span class="std std-ref">#UDG</span></a>,
<a class="reference internal" href="#udgarray"><span class="std std-ref">#UDGARRAY</span></a> and <a class="reference internal" href="#udgs"><span class="std std-ref">#UDGS</span></a> macros can be used to specify not only an image
filename, but also its exact location, the <code class="docutils literal notranslate"><span class="pre">alt</span></code> attribute of the <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code>
element, and a frame name (see <a class="reference internal" href="#animation"><span class="std std-ref">Animation</span></a>).</p>
<p>If <code class="docutils literal notranslate"><span class="pre">fname</span></code> contains an image path ID replacement field (e.g.
<code class="docutils literal notranslate"><span class="pre">{ScreenshotImagePath}/udgs</span></code>), the corresponding parameter value from the
<a class="reference internal" href="ref-files.html#paths"><span class="std std-ref">[Paths]</span></a> section will be substituted.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">fname</span></code> starts with a ‘/’, the filename is taken to be relative to the
root of the HTML disassembly.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">fname</span></code> contains no image path ID replacement fields and does not start
with a ‘/’, the filename is taken to be relative to the directory defined by
one of the following parameters in the <a class="reference internal" href="ref-files.html#paths"><span class="std std-ref">[Paths]</span></a> section, depending on the
macro being used:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">FontImagePath</span></code> - <a class="reference internal" href="#font"><span class="std std-ref">#FONT</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ScreenshotImagePath</span></code> - <a class="reference internal" href="#scr"><span class="std std-ref">#SCR</span></a></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UdgImagePath</span></code> - <a class="reference internal" href="#udg"><span class="std std-ref">#UDG</span></a>, <a class="reference internal" href="#udgarray"><span class="std std-ref">#UDGARRAY</span></a> and <a class="reference internal" href="#udgs"><span class="std std-ref">#UDGS</span></a></p></li>
</ul>
<p>If <code class="docutils literal notranslate"><span class="pre">fname</span></code> does not end with ‘<cite>.png</cite>’, that suffix will be appended.</p>
<p>If an image with the given filename doesn’t already exist, it will be created.</p>
<p>The value of the <code class="docutils literal notranslate"><span class="pre">alt</span></code> attribute in the <code class="docutils literal notranslate"><span class="pre">&lt;img&gt;</span></code> element can be specified by
appending a <code class="docutils literal notranslate"><span class="pre">|</span></code> character and the required text to the filename. For
example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#SCR(screenshot1|Screenshot 1)
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">#SCR</span></code> macro creates an image named <cite>screenshot1.png</cite> with alt text
‘Screenshot 1’.</p>
</section>
<section id="animation">
<span id="id42"></span><h3>Animation<a class="headerlink" href="#animation" title="Permalink to this heading">¶</a></h3>
<p>The image macros may be used to create the frames of an animated image. To
create a frame, the <code class="docutils literal notranslate"><span class="pre">fname</span></code> parameter must have one of the following forms:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name*</span></code> - writes an image file with this name, and also creates a frame
with the same name</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">name1*name2</span></code> - writes an image file named <cite>name1</cite>, and also creates a
frame named <cite>name2</cite></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">*name</span></code> - writes no image file, but creates a frame with this name</p></li>
</ul>
<p>Then a special form of the <code class="docutils literal notranslate"><span class="pre">#UDGARRAY</span></code> macro creates the animated image from
a set of frames:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDGARRAY*(FRAME1[;FRAME2;...])(fname)
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">FRAME1</span></code>, <code class="docutils literal notranslate"><span class="pre">FRAME2</span></code> etc. are frame specifications. The parentheses around
them are optional, but recommended. Each frame specification has the form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>name[,delay,x,y]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> is the name of the frame</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">delay</span></code> is the delay between this frame and the next in 1/100ths of a
second; it also sets the default delay for any frames that follow (default:
32)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> are the coordinates at which to render the frame, relative to
the top-left corner of the first frame (default: (0,0))</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #UDGTABLE {
; #FONT:(hello)$3D00(hello*) |
; #FONT:(there)$3D00(there*) |
; #FONT:(peeps)$3D00(peeps*) |
; #UDGARRAY*(hello,50;there;peeps)(hello_there_peeps)
; } TABLE#
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">#FONT</span></code> macros create the required frames (and write images of them); the
<code class="docutils literal notranslate"><span class="pre">#UDGARRAY</span></code> macro combines the three frames into a single animated image,
with a delay of 0.5s between each frame.</p>
<p>The integer parameters of a frame specification may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>Note that the first frame of an animated image determines the size of the image
as a whole. Therefore, the region defined by the width, height and coordinates
of any subsequent frame must fall entirely inside the first frame.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.6</p></td>
<td><p>The frame specifications may be enclosed in parentheses</p></td>
</tr>
<tr class="row-odd"><td><p>8.3</p></td>
<td><p>Added the <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> parameters to the frame specification;
added support for replacement fields in the integer parameters of
a frame specification</p></td>
</tr>
<tr class="row-even"><td><p>3.6</p></td>
<td><p>New</p></td>
</tr>
</tbody>
</table>
</section>
<section id="cropping">
<span id="id43"></span><h3>Cropping<a class="headerlink" href="#cropping" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference internal" href="#copy"><span class="std std-ref">#COPY</span></a>, <a class="reference internal" href="#font"><span class="std std-ref">#FONT</span></a>, <a class="reference internal" href="#scr"><span class="std std-ref">#SCR</span></a>, <a class="reference internal" href="#udg"><span class="std std-ref">#UDG</span></a>, <a class="reference internal" href="#udgarray"><span class="std std-ref">#UDGARRAY</span></a> and
<a class="reference internal" href="#udgs"><span class="std std-ref">#UDGS</span></a> macros accept a cropping specification (<code class="docutils literal notranslate"><span class="pre">CROP</span></code>) which takes the
form:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>x,y,width,height
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">x</span></code> is the x-coordinate of the leftmost pixel column of the constructed
image to include in the final image (default: 0); if greater than 0, the
image will be cropped on the left</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">y</span></code> is the y-coordinate of the topmost pixel row of the constructed image
to include in the final image (default: 0); if greater than 0, the image will
be cropped on the top</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">width</span></code> is the width of the final image in pixels (default: width of the
constructed image)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">height</span></code> is the height of the final image in pixels (default: height of the
constructed image)</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG40000,scale=2{2,2,12,12}
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">#UDG</span></code> macro creates an image of the UDG at 40000, at scale 2, with the
top two rows and bottom two rows of pixels removed, and the leftmost two
columns and rightmost two columns of pixels removed.</p>
<p>The parameters of the cropping specification may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
</section>
<section id="masks">
<span id="id44"></span><h3>Masks<a class="headerlink" href="#masks" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference internal" href="#copy"><span class="std std-ref">#COPY</span></a>, <a class="reference internal" href="#udg"><span class="std std-ref">#UDG</span></a>, <a class="reference internal" href="#udgarray"><span class="std std-ref">#UDGARRAY</span></a> and <a class="reference internal" href="#udgs"><span class="std std-ref">#UDGS</span></a> macros accept a
<code class="docutils literal notranslate"><span class="pre">mask</span></code> parameter that determines what kind of mask to apply to each UDG. The
supported values are:</p>
<ul class="simple">
<li><p>0 - no mask</p></li>
<li><p>1 - OR-AND mask (this is the default)</p></li>
<li><p>2 - AND-OR mask</p></li>
</ul>
<p>Given a ‘background’ bit (B), a UDG bit (U), and a mask bit (M), the OR-AND
mask works as follows:</p>
<ul class="simple">
<li><p>OR the UDG bit (U) onto the background bit (B)</p></li>
<li><p>AND the mask bit (M) onto the result</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>U</p></th>
<th class="head"><p>M</p></th>
<th class="head"><p>Result</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>0 (paper)</p></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>B (transparent)</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>0</p></td>
<td><p>0 (paper)</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>1 (ink)</p></td>
</tr>
</tbody>
</table>
<p>The AND-OR mask works as follows:</p>
<ul class="simple">
<li><p>AND the mask bit (M) onto the background bit (B)</p></li>
<li><p>OR the UDG bit (U) onto the result</p></li>
</ul>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>U</p></th>
<th class="head"><p>M</p></th>
<th class="head"><p>Result</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>0 (paper)</p></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>B (transparent)</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>0</p></td>
<td><p>1 (ink)</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>1</p></td>
<td><p>1 (ink)</p></td>
</tr>
</tbody>
</table>
<p>By default, transparent bits in masked images are rendered in bright green
(#00fe00); this colour can be changed by modifying the <code class="docutils literal notranslate"><span class="pre">TRANSPARENT</span></code>
parameter in the <a class="reference internal" href="ref-files.html#ref-colours"><span class="std std-ref">[Colours]</span></a> section. To make the transparent bits in
masked images actually transparent, set <code class="docutils literal notranslate"><span class="pre">PNGAlpha=0</span></code> in the
<a class="reference internal" href="ref-files.html#ref-imagewriter"><span class="std std-ref">[ImageWriter]</span></a> section.</p>
</section>
<section id="palette">
<span id="id45"></span><h3>Palette<a class="headerlink" href="#palette" title="Permalink to this heading">¶</a></h3>
<p>Images created by the image macros use colours drawn from a palette of 16
entries:</p>
<ul class="simple">
<li><p>0 - transparent</p></li>
<li><p>1 - black</p></li>
<li><p>2 - blue</p></li>
<li><p>3 - red</p></li>
<li><p>4 - magenta</p></li>
<li><p>5 - green</p></li>
<li><p>6 - cyan</p></li>
<li><p>7 - yellow</p></li>
<li><p>8 - white</p></li>
<li><p>9 - bright blue</p></li>
<li><p>10 - bright red</p></li>
<li><p>11 - bright magenta</p></li>
<li><p>12 - bright green</p></li>
<li><p>13 - bright cyan</p></li>
<li><p>14 - bright yellow</p></li>
<li><p>15 - bright white</p></li>
</ul>
<p>The RGB values for these colours are defined in the <a class="reference internal" href="ref-files.html#ref-colours"><span class="std std-ref">[Colours]</span></a> section.</p>
<p>The index values (0-15) may be used by an image macro’s <code class="docutils literal notranslate"><span class="pre">tindex</span></code> parameter to
specify a transparent colour to use other than the default (0). The palette
entry specified by <code class="docutils literal notranslate"><span class="pre">tindex</span></code>, if not 0, will be used as the transparent colour
only if the image does not already contain any transparent bits produced by a
<a class="reference internal" href="#masks"><span class="std std-ref">mask</span></a>. In an animated image, the <code class="docutils literal notranslate"><span class="pre">tindex</span></code> and <code class="docutils literal notranslate"><span class="pre">alpha</span></code> values
on the first frame take effect; any <code class="docutils literal notranslate"><span class="pre">tindex</span></code> and <code class="docutils literal notranslate"><span class="pre">alpha</span></code> values on the
second or subsequent frames are ignored.</p>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG30000,attr=2,tindex=1,alpha=0
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">#UDG</span></code> macro creates an image of the UDG at 30000 with red INK and black
PAPER (<code class="docutils literal notranslate"><span class="pre">attr=2</span></code>), black as the transparent colour (<code class="docutils literal notranslate"><span class="pre">tindex=1</span></code>), and full
transparency (<code class="docutils literal notranslate"><span class="pre">alpha=0</span></code>).</p>
</section>
</section>
<section id="snapshot-macros">
<h2>Snapshot macros<a class="headerlink" href="#snapshot-macros" title="Permalink to this heading">¶</a></h2>
<p>The <a class="reference internal" href="#pokes"><span class="std std-ref">#POKES</span></a>, <a class="reference internal" href="#pops"><span class="std std-ref">#POPS</span></a> and <a class="reference internal" href="#pushs"><span class="std std-ref">#PUSHS</span></a> macros (described in the
following sections) may be used to manipulate the memory snapshot that is built
from the skool file. Each macro expands to an empty string.</p>
<section id="pokes">
<span id="id46"></span><h3>#POKES<a class="headerlink" href="#pokes" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#POKES</span></code> macro POKEs values into the current memory snapshot.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#POKESaddr,byte[,length,step][;addr,byte[,length,step];...]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">addr</span></code> is the address to POKE</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">byte</span></code> is the value to POKE <code class="docutils literal notranslate"><span class="pre">addr</span></code> with</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">length</span></code> is the number of addresses to POKE (default: 1)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step</span></code> is the address increment to use after each POKE (if <code class="docutils literal notranslate"><span class="pre">length</span></code>&gt;1;
default: 1)</p></li>
</ul>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>The UDG looks like this:

#UDG32768(udg_orig)

But it&#39;s supposed to look like this:

#PUSHS
#POKES32772,254;32775,136
#UDG32768(udg_fixed)
#POPS
</pre></div>
</div>
<p>This instance of the <code class="docutils literal notranslate"><span class="pre">#POKES</span></code> macro does <code class="docutils literal notranslate"><span class="pre">POKE</span> <span class="pre">32772,254</span></code> and
<code class="docutils literal notranslate"><span class="pre">POKE</span> <span class="pre">32775,136</span></code>, which fixes a graphic glitch in the UDG at 32768.</p>
<p>The parameter string of the <code class="docutils literal notranslate"><span class="pre">#POKES</span></code> macro may contain
<a class="reference internal" href="#replacementfields"><span class="std std-ref">replacement fields</span></a>.</p>
<p>See also <a class="reference internal" href="#peek"><span class="std std-ref">#PEEK</span></a>.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>8.3</p></td>
<td><p>Added support for replacement fields in the parameter string</p></td>
</tr>
<tr class="row-odd"><td><p>5.1</p></td>
<td><p>Added support for arithmetic expressions and skool macros in the
parameter string</p></td>
</tr>
<tr class="row-even"><td><p>3.1</p></td>
<td><p>Added support for ASM mode</p></td>
</tr>
<tr class="row-odd"><td><p>2.3.1</p></td>
<td><p>Added support for multiple addresses</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pops">
<span id="id47"></span><h3>#POPS<a class="headerlink" href="#pops" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#POPS</span></code> macro removes the current internal memory snapshot and replaces
it with the one that was previously saved by a <code class="docutils literal notranslate"><span class="pre">#PUSHS</span></code> macro.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#POPS
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>3.1</p></td>
<td><p>Added support for ASM mode</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pushs">
<span id="id48"></span><h3>#PUSHS<a class="headerlink" href="#pushs" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">#PUSHS</span></code> macro saves the current internal memory snapshot, and replaces
it with an identical copy with a given name.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#PUSHS[name]
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name</span></code> is the snapshot name (defaults to an empty string)</p></li>
</ul>
<p>The snapshot name must be limited to the characters ‘$’, ‘#’, 0-9, A-Z and a-z;
it must not start with a capital letter. The name can be retrieved by using the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">get_snapshot_name()</span></code> method on HtmlWriter.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Version</p></th>
<th class="head"><p>Changes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>3.1</p></td>
<td><p>Added support for ASM mode</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="defining-macros-with-def">
<span id="definingmacroswithdef"></span><h2>Defining macros with #DEF<a class="headerlink" href="#defining-macros-with-def" title="Permalink to this heading">¶</a></h2>
<p>By using the <a class="reference internal" href="#def"><span class="std std-ref">#DEF</span></a> macro, it is possible to define new macros based on
existing ones without writing any Python code. Some examples are given below.</p>
<section id="asm">
<h3>#ASM<a class="headerlink" href="#asm" title="Permalink to this heading">¶</a></h3>
<p>There is the <a class="reference internal" href="#html"><span class="std std-ref">#HTML</span></a> macro for inserting content in HTML mode only, but
there is no corresponding macro for inserting content in ASM mode only. The
following <code class="docutils literal notranslate"><span class="pre">#DEF</span></code> macro defines an <code class="docutils literal notranslate"><span class="pre">#ASM</span></code> macro to fill that gap:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF(#ASM #IF({mode[asm]}))
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#ASM(This text appears only in ASM mode.)
</pre></div>
</div>
</section>
<section id="asmudg">
<h3>#ASMUDG<a class="headerlink" href="#asmudg" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference internal" href="#udg"><span class="std std-ref">#UDG</span></a> macro is not supported in ASM mode, but <code class="docutils literal notranslate"><span class="pre">#DEF</span></code> can define an
<code class="docutils literal notranslate"><span class="pre">#ASMUDG</span></code> macro (based on the <code class="docutils literal notranslate"><span class="pre">#ASM</span></code> macro defined above) that is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF(#ASMUDG(a) #ASM(#LIST(,) #FOR($a,$a+7)(u,{ |#FOR(7,0,-1)(n,#IF(#PEEKu&amp;2**n)(*, ))| }) LIST#))
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; #ASMUDG30000
 30000 DEFB 48,72,136,144,104,4,10,4
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">#ASMUDG</span></code> macro produces the following output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>; |  **    |
; | *  *   |
; |*   *   |
; |*  *    |
; | ** *   |
; |     *  |
; |    * * |
; |     *  |
</pre></div>
</div>
</section>
<section id="tile-tiles">
<h3>#TILE, #TILES<a class="headerlink" href="#tile-tiles" title="Permalink to this heading">¶</a></h3>
<p>Suppose the game you’re disassembling arranges tiles in groups of nine bytes:
the attribute byte first, followed by the eight graphic bytes. If there is a
tile at 32768, then:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDG(32769,#PEEK32768)
</pre></div>
</div>
<p>will create an image of it. If you want to create several tile images, this
syntax can get cumbersome; it would be easier if you could supply just the
address of the attribute byte. The following <code class="docutils literal notranslate"><span class="pre">#DEF</span></code> macro defines a <code class="docutils literal notranslate"><span class="pre">#TILE</span></code>
macro that creates a tile image given an attribute byte address:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF(#TILE(a) #UDG($a+1,#PEEK$a))
</pre></div>
</div>
<p>Now you can create an image of the tile at 32768 like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#TILE32768
</pre></div>
</div>
<p>If you have several nine-byte tiles arranged one after the other, you might
want to create images of all of them in a single row of a <code class="docutils literal notranslate"><span class="pre">#UDGTABLE</span></code>. The
following <code class="docutils literal notranslate"><span class="pre">#DEF</span></code> macro defines a <code class="docutils literal notranslate"><span class="pre">#TILES</span></code> macro (based on the <code class="docutils literal notranslate"><span class="pre">#TILE</span></code>
macro already defined) for this purpose:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#DEF(#TILES(a,m) #FOR($a,$a+9*($m-1),9)(n,#TILEn, | ))
</pre></div>
</div>
<p>Now you can create a <code class="docutils literal notranslate"><span class="pre">#UDGTABLE</span></code> of images of a series of 10 tiles starting
at 32768 like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#UDGTABLE { #TILES32768,10 } TABLE#
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Skool macros</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#numeric-parameters">Numeric parameters</a></li>
<li><a class="reference internal" href="#string-parameters">String parameters</a></li>
<li><a class="reference internal" href="#replacement-fields">Replacement fields</a></li>
<li><a class="reference internal" href="#smpl-macros">SMPL macros</a><ul>
<li><a class="reference internal" href="#hash">#()</a></li>
<li><a class="reference internal" href="#def">#DEF</a></li>
<li><a class="reference internal" href="#eval">#EVAL</a></li>
<li><a class="reference internal" href="#for">#FOR</a></li>
<li><a class="reference internal" href="#foreach">#FOREACH</a></li>
<li><a class="reference internal" href="#format">#FORMAT</a></li>
<li><a class="reference internal" href="#if">#IF</a></li>
<li><a class="reference internal" href="#let">#LET</a></li>
<li><a class="reference internal" href="#map">#MAP</a></li>
<li><a class="reference internal" href="#pc">#PC</a></li>
<li><a class="reference internal" href="#peek">#PEEK</a></li>
<li><a class="reference internal" href="#str">#STR</a></li>
<li><a class="reference internal" href="#while">#WHILE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#general-macros">General macros</a><ul>
<li><a class="reference internal" href="#audio">#AUDIO</a></li>
<li><a class="reference internal" href="#bank">#BANK</a></li>
<li><a class="reference internal" href="#call">#CALL</a></li>
<li><a class="reference internal" href="#chr">#CHR</a></li>
<li><a class="reference internal" href="#d">#D</a></li>
<li><a class="reference internal" href="#html">#HTML</a></li>
<li><a class="reference internal" href="#include">#INCLUDE</a></li>
<li><a class="reference internal" href="#link">#LINK</a></li>
<li><a class="reference internal" href="#list">#LIST</a></li>
<li><a class="reference internal" href="#n">#N</a></li>
<li><a class="reference internal" href="#r">#R</a></li>
<li><a class="reference internal" href="#raw">#RAW</a></li>
<li><a class="reference internal" href="#reg">#REG</a></li>
<li><a class="reference internal" href="#sim">#SIM</a></li>
<li><a class="reference internal" href="#space">#SPACE</a></li>
<li><a class="reference internal" href="#table">#TABLE</a></li>
<li><a class="reference internal" href="#tstates">#TSTATES</a></li>
<li><a class="reference internal" href="#udgtable">#UDGTABLE</a></li>
<li><a class="reference internal" href="#version">#VERSION</a></li>
</ul>
</li>
<li><a class="reference internal" href="#image-macros">Image macros</a><ul>
<li><a class="reference internal" href="#copy">#COPY</a></li>
<li><a class="reference internal" href="#font">#FONT</a></li>
<li><a class="reference internal" href="#over">#OVER</a></li>
<li><a class="reference internal" href="#plot">#PLOT</a></li>
<li><a class="reference internal" href="#scr">#SCR</a></li>
<li><a class="reference internal" href="#udg">#UDG</a></li>
<li><a class="reference internal" href="#udgarray">#UDGARRAY</a></li>
<li><a class="reference internal" href="#udgs">#UDGS</a></li>
<li><a class="reference internal" href="#filenames">Filenames</a></li>
<li><a class="reference internal" href="#animation">Animation</a></li>
<li><a class="reference internal" href="#cropping">Cropping</a></li>
<li><a class="reference internal" href="#masks">Masks</a></li>
<li><a class="reference internal" href="#palette">Palette</a></li>
</ul>
</li>
<li><a class="reference internal" href="#snapshot-macros">Snapshot macros</a><ul>
<li><a class="reference internal" href="#pokes">#POKES</a></li>
<li><a class="reference internal" href="#pops">#POPS</a></li>
<li><a class="reference internal" href="#pushs">#PUSHS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#defining-macros-with-def">Defining macros with #DEF</a><ul>
<li><a class="reference internal" href="#asm">#ASM</a></li>
<li><a class="reference internal" href="#asmudg">#ASMUDG</a></li>
<li><a class="reference internal" href="#tile-tiles">#TILE, #TILES</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="skool-files.html"
                          title="previous chapter">Skool files</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="ref-files.html"
                          title="next chapter">Ref files</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/skool-macros.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ref-files.html" title="Ref files"
             >next</a> |</li>
        <li class="right" >
          <a href="skool-files.html" title="Skool files"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">SkoolKit 9.3 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Skool macros</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2024, Richard Dymond.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.3.0.
    </div>
  </body>
</html>